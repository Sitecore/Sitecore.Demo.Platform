---
ID: "74c90c57-1a52-4d14-97e9-bc7c0baae09f"
Parent: "594d7d33-1176-417b-864a-e8810e5d2946"
Template: "962b53c4-f93b-4df9-9821-415c867b8903"
Path: "/sitecore/media library/Themes/Habitat Sites/Habitat Home/scripts/component-carousel"
DB: master
SharedFields:
- ID: "06d5295c-ed2f-4a54-9bf2-26228d113318"
  Hint: __Icon
  Value: "-/media/35F24F1601B441E68B7F83CE6717579E.ashx?h=16&thn=1&w=16"
- ID: "40e50ed9-ba07-4702-992e-a912738d32dc"
  Hint: Blob
  BlobID: "37b92d00-da5e-40fa-b937-3b0f2106b6ce"
  Value: LyoqDQogKiBYQUNvbnRleHQNCiAqDQogKiBYQS5jb21wb25lbnQuY2Fyb3VzZWxzIG1vZHVsZS4NCiAqDQogKiBFeHBvc2VzIHJlZ2lzdGVyKHNlbGVjdG9yLCBvcHRpb25zKSBtZXRob2QsIHdoaWNoIGluaXRpYWxpemVzIENhcm91c2VsDQogKiBmb3IgZWFjaCBlbGVtZW50cyB0aGF0IG1hdGNoIHRoZSBwcm92aWRlZCBzZWxlY3Rvciwgd2l0aCBnaXZlbiBvcHRpb25zLg0KICogRWxlbWVudCB1c2VkIGFzIGEgY2Fyb3VzZWwgbXVzdCBjb250YWluIGEgPHVsIGNsYXNzPSJzbGlkZXMiPiB0YWcuDQogKiBUaGF0IHRhZyBoYXZlIHRvIGJlIGZpbGxlZCB3aXRoIDxsaT4gZWxlbWVudHMuIEVhY2ggPGxpPiBlbGVtZW50IHdpbGwgYmUgY29uc2lkZXJlZCBhcyBhIHNsaWRlLg0KICogRm9yIG1vcmUgZGV0YWlscyByZWFkIHRoZSBkb2N1bWVudGF0aW9uIG9mIGEgcmVnaXN0ZXIoc2VsZWN0b3IsIG9wdGlvbnMpIG1ldGhvZC4NCiAqDQogKiBAcmVxdWlyZXMgalF1ZXJ5IEphdmFTY3JpcHQgTGlicmFyeSB2MS40LjQgb3IgaGlnaGVyDQogKi8NCi8qIGdsb2JhbCBIYW1tZXI6dHJ1ZSAqLw0KWEEuY29tcG9uZW50LmNhcm91c2VscyA9IChmdW5jdGlvbigkKSB7DQogICAgdmFyIHB1YiA9IHt9LA0KICAgICAgICBOYXZpZ2F0aW9uQnVpbGRlciA9IG51bGwsDQogICAgICAgIFNsaWRlckluaXRpYWxpemVyID0gbnVsbDsNCg0KICAgIC8qKg0KICAgICAqIFRpbWVyIGNsYXNzIHNhdmVzIHRpbWUgc3RhbXAgYW5kIGNvdW50cyB0aW1lIGRpZmZlcmVuY2UgYmV0d2Vlbg0KICAgICAqIGN1cnJlbnQgdGltZSAodXBkYXRlKCkgbWV0aG9kKSBhbmQgc2F2ZWQgdGltZSBzdGFtcC4NCiAgICAgKiBAY29uc3RydWN0b3INCiAgICAgKi8NCiAgICBmdW5jdGlvbiBUaW1lcigpIHsNCiAgICAgICAgLyoqDQogICAgICAgICAqIFRpbWUgZGlmZmVyZW5jZSBiZXR3ZWVuIGxhc3QgdXBkYXRlKCkgY2FsbCBhbmQgbGFzdCBzZXQoKSBjYWxsDQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgVGltZXINCiAgICAgICAgICovDQogICAgICAgIHRoaXMuZWxhcHNlZCA9IDA7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBUaW1lIHN0YW1wDQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgVGltZXINCiAgICAgICAgICovDQogICAgICAgIHRoaXMuc3RhbXAgPSBudWxsOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqICBDb3VudHMgdGltZSBkaWZmZXJlbmNlIGJldHdlZW4gY3VycmVudCB0aW1lIGFuZCBzYXZlZCB0aW1lIHN0YW1wDQogICAgICoNCiAgICAgKiBAbWVtYmVyIFRpbWVyDQogICAgICovDQogICAgVGltZXIucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uKCkgew0KICAgICAgICBpZiAodGhpcy5zdGFtcCAhPT0gbnVsbCkgew0KICAgICAgICAgICAgdGhpcy5lbGFwc2VkICs9IHRoaXMubmV3U3RhbXAoKSAtIHRoaXMuc3RhbXA7DQogICAgICAgIH0NCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogIFNhdmVzIG5ldyB0aW1lIHN0YW1wDQogICAgICoNCiAgICAgKiBAbWVtYmVyIFRpbWVyDQogICAgICovDQogICAgVGltZXIucHJvdG90eXBlLnNldCA9IGZ1bmN0aW9uKCkgew0KICAgICAgICB0aGlzLnN0YW1wID0gdGhpcy5uZXdTdGFtcCgpOw0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiAgQ291bnRzIHRpbWUgZGlmZmVyZW5jZSBiZXR3ZWVuIGN1cnJlbnQgdGltZSBhbmQgc2F2ZWQgdGltZSBzdGFtcA0KICAgICAqDQogICAgICogQG1lbWJlciBUaW1lcg0KICAgICAqIEByZXR1cm4gc3RhbXAgb2YgYSBjdXJyZW50IHRpbWUNCiAgICAgKiBAdHlwZSBOdW1iZXINCiAgICAgKi8NCiAgICBUaW1lci5wcm90b3R5cGUubmV3U3RhbXAgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgcmV0dXJuIG5ldyBEYXRlKCkudmFsdWVPZigpOw0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiAgUmVzZXRzIGVsYXBzZWQgdGltZS4NCiAgICAgKg0KICAgICAqIEBtZW1iZXIgVGltZXINCiAgICAgKi8NCiAgICBUaW1lci5wcm90b3R5cGUucmVzZXQgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgdGhpcy5lbGFwc2VkID0gMDsNCiAgICB9Ow0KICAgIC8qKg0KICAgICAqIEVuZCBvZiBUaW1lciBjbGFzcw0KICAgICAqLw0KDQogICAgLyoqDQogICAgICogVGltZUluZGljYXRvciBjbGFzcyBleHRlbmRzIFRpbWVyIGNsYXNzDQogICAgICogQGNvbnN0cnVjdG9yDQogICAgICogQHBhcmFtIHtPYmplY3R9ICQgICAgIGEgalF1ZXJ5IG9iamVjdA0KICAgICAqIEBwYXJhbSB7WEEuY29tcG9uZW50LmNhcm91c2Vscy5JbmRpY2F0b3JWaWV3cy5WaWV3fSB2aWV3ICBhIHRpbWUgaW5kaWNhdG9yIHZpZXcuDQogICAgICogQHBhcmFtIHtOdW1iZXJ9IHRpbWVvdXQgICBhIHZpZXcgdGltZW91dA0KICAgICAqIEBiYXNlIFRpbWVyDQogICAgICovDQogICAgZnVuY3Rpb24gVGltZUluZGljYXRvcigkLCB2aWV3LCB0aW1lb3V0KSB7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBBIHRpbWUgaW5kaWNhdG9yIHZpZXcuDQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgVGltZXJJbmRpY2F0b3INCiAgICAgICAgICovDQogICAgICAgIHRoaXMudmlldyA9IHZpZXc7DQoNCiAgICAgICAgdGhpcy52aWV3LmluaXQodGltZW91dCk7DQogICAgfQ0KICAgIFRpbWVJbmRpY2F0b3IucHJvdG90eXBlID0gbmV3IFRpbWVyKCk7DQogICAgVGltZUluZGljYXRvci5jb25zdHJ1Y3RvciA9IFRpbWVyOw0KDQogICAgLyoqDQogICAgICogUGxheXMgdGhlIGF0dGFjaGVkIHZpZXcuDQogICAgICoNCiAgICAgKiBAbWVtYmVyIFRpbWVySW5kaWNhdG9yDQogICAgICovDQogICAgVGltZUluZGljYXRvci5wcm90b3R5cGUucGxheSA9IGZ1bmN0aW9uKCkgew0KICAgICAgICB0aGlzLnZpZXcucGxheSgpOw0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiBQYXVzZXMgdGhlIGF0dGFjaGVkIHZpZXcuDQogICAgICoNCiAgICAgKiBAbWVtYmVyIFRpbWVySW5kaWNhdG9yDQogICAgICovDQogICAgVGltZUluZGljYXRvci5wcm90b3R5cGUucGF1c2UgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgdGhpcy52aWV3LnBhdXNlKCk7DQogICAgfTsNCg0KICAgIC8qKg0KICAgICAqIFJlc2V0cyBlbGFwc2VkIHRpbWUgYW5kIHJlc2V0cyB0aGUgYXR0YWNoZWQgdmlldy4NCiAgICAgKg0KICAgICAqIEBtZW1iZXIgVGltZXJJbmRpY2F0b3INCiAgICAgKi8NCiAgICBUaW1lSW5kaWNhdG9yLnByb3RvdHlwZS5yZXNldCA9IGZ1bmN0aW9uKCkgew0KICAgICAgICBUaW1lci5wcm90b3R5cGUucmVzZXQuY2FsbCh0aGlzKTsNCiAgICAgICAgdGhpcy52aWV3LnJlc2V0KCk7DQogICAgfTsNCg0KICAgIC8qKg0KICAgICAqIENvdW50cyB0aW1lIGRpZmZlcmVuY2UgYmV0d2VlbiBjdXJyZW50IHRpbWUgYW5kIHNhdmVkIHRpbWUgc3RhbXAuDQogICAgICogYW5kIHVwZGF0ZXMgdGhlIGF0dGFjaGVkIHZpZXcNCiAgICAgKg0KICAgICAqIEBtZW1iZXIgVGltZXJJbmRpY2F0b3INCiAgICAgKi8NCiAgICBUaW1lSW5kaWNhdG9yLnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgVGltZXIucHJvdG90eXBlLnVwZGF0ZS5jYWxsKHRoaXMpOw0KICAgICAgICB0aGlzLnZpZXcudXBkYXRlKHRoaXMuZWxhcHNlZCk7DQogICAgfTsNCiAgICAvKioNCiAgICAgKiBlbmQgb2YgVGltZUluZGljYXRvciBjbGFzcw0KICAgICAqLw0KDQogICAgLyoqDQogICAgICogTmF2aWdhdGlvbkJ1aWxkZXIgb2JqZWN0IGNyZWF0ZXMgbmF2aWdhdGlvbiBpdGVtcw0KICAgICAqLw0KICAgIE5hdmlnYXRpb25CdWlsZGVyID0gKGZ1bmN0aW9uKCQpIHsNCiAgICAgICAgZnVuY3Rpb24gY3JlYXRlSXRlbShzZXR0aW5ncykgew0KICAgICAgICAgICAgdmFyIHRleHQgPSBzZXR0aW5ncy50ZXh0LA0KICAgICAgICAgICAgICAgICRuYXZJdGVtID0gbnVsbDsNCg0KICAgICAgICAgICAgc2V0dGluZ3MudGV4dCA9ICcnOw0KICAgICAgICAgICAgc2V0dGluZ3MuaHJlZiA9ICcjJzsNCg0KICAgICAgICAgICAgJG5hdkl0ZW0gPSAkKCc8YT4nLCBzZXR0aW5ncyk7DQogICAgICAgICAgICAkKCc8c3Bhbj4nLCB7DQogICAgICAgICAgICAgICAgJ3RleHQnOiB0ZXh0DQogICAgICAgICAgICB9KS5hcHBlbmRUbygkbmF2SXRlbSk7DQoNCiAgICAgICAgICAgIHJldHVybiAkbmF2SXRlbTsNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiB7DQogICAgICAgICAgICAvKioNCiAgICAgICAgICAgICAqIFJldHVybnMgdGhlIGVsZW1lbnQocykgdGhhdCBtYXRjaChlcykgdGhlIHByb3ZpZGVkIHNlbGVjdG9yIG9yIG51bGwNCiAgICAgICAgICAgICAqDQogICAgICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gc2VsZWN0b3IgYSBzZWxlY3RvciB1c2VkIGZvciBzZWFyY2hpbmcNCiAgICAgICAgICAgICAqIEByZXR1cm4gYSBqUXVlcnkgb2JqZWN0IGNvbnRhaW5pbmcgZWxlbWVudChzKSB0aGF0IG1hdGNoKGVzKSB0aGUgcHJvdmlkZWQgc2VsZWN0b3Igb3IgbnVsbCBpZiBubyBlbGVtZW50IG1hdGNoDQogICAgICAgICAgICAgKiBAdHlwZSBPYmplY3QNCiAgICAgICAgICAgICAqLw0KICAgICAgICAgICAgZ2V0RWxlbWVudDogZnVuY3Rpb24oc2VsZWN0b3IpIHsNCiAgICAgICAgICAgICAgICB2YXIgJGVsZW1lbnQgPSAkKHNlbGVjdG9yKTsNCg0KICAgICAgICAgICAgICAgIGlmICgkZWxlbWVudC5sZW5ndGggPT09IDApIHsNCiAgICAgICAgICAgICAgICAgICAgJGVsZW1lbnQgPSBudWxsOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIHJldHVybiAkZWxlbWVudDsNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICAvKioNCiAgICAgICAgICAgICAqIENyZWF0ZXMgbmF2aWdhdGlvbiBpdGVtcyBhbmQgYXBwZW5kcyB0aGVtIHRvICRjb250YWluZXIuDQogICAgICAgICAgICAgKg0KICAgICAgICAgICAgICogQHBhcmFtIHtPYmplY3R9ICRjb250YWluZXIgICBuYXZpZ2F0aW9uIGl0ZW1zIGNvbnRhaW5lciAoalF1ZXJ5IG9iamVjdCkNCiAgICAgICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBsYWJlbCAgIG5hdmlnYXRpb24gaXRlbXMgbGFiZWwgdGVtcGxhdGUNCiAgICAgICAgICAgICAqIEBwYXJhbSB7TnVtYmVyfSBjb3VudCAgICBudW1iZXIgb2YgbmF2aWdhdGlvbiBpdGVtcyB0byBjcmVhdGUNCiAgICAgICAgICAgICAqLw0KICAgICAgICAgICAgY3JlYXRlSXRlbXM6IGZ1bmN0aW9uKCRjb250YWluZXIsIGxhYmVsLCBjb3VudCkgew0KICAgICAgICAgICAgICAgIHZhciBpLA0KICAgICAgICAgICAgICAgICAgICBwYXR0ZXJuID0gLyNce2luZGV4XH0vZywNCiAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3M7DQoNCiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgY291bnQ7IGkrKykgew0KICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncyA9IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICd0ZXh0JzogbGFiZWwucmVwbGFjZShwYXR0ZXJuLCBpICsgMSkNCiAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgICAgY3JlYXRlSXRlbShzZXR0aW5ncykuYXBwZW5kVG8oJGNvbnRhaW5lcik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIC8qKg0KICAgICAgICAgICAgICogQ3JlYXRlcyBvciBzZWxlY3RzICdwcmV2aW91cycvJ25leHQnIG5hdmlnYXRpb24gaXRlbS4NCiAgICAgICAgICAgICAqIE1vZGUgb2YgYWN0aW9uIGRlcGVuZHMgb24gc2V0dGluZ3Mgb2JqZWN0Og0KICAgICAgICAgICAgICogdmFyIHNldHRpbmdzID0gew0KICAgICAgICAgICAgICogICAgIGlzQ29udGFpbmVyOiBCb29sZWFuIHZhbHVlLA0KICAgICAgICAgICAgICogICAgIGxhYmVsOiBTdHJpbmcgdmFsdWUsDQogICAgICAgICAgICAgKiAgICAgc2VsZWN0b3I6IFN0cmluZyB2YWx1ZSwNCiAgICAgICAgICAgICAqICAgICBtZXRob2Q6IFN0cmluZyB2YWx1ZQ0KICAgICAgICAgICAgICogfTsNCiAgICAgICAgICAgICAqDQogICAgICAgICAgICAgKiBJZiBzZXR0aW5ncy5zZWxlY3RvciA9PT0gbnVsbCBvciBpZiBzZXR0aW5ncy5zZWxlY3RvciAhPT0gbnVsbCBhbmQgc2V0dGluZ3MuaXNDb250YWluZXIgPT0gdHJ1ZQ0KICAgICAgICAgICAgICogbmF2aWdhdGlvbiBpdGVtIGlzIGNyZWF0ZWQgYW5kIGF0dGFjaGVkIHRvICRlbGVtZW50LmZpcnN0KCkgKHVzaW5nIHNldHRpbmdzLm1ldGhvZCkuDQogICAgICAgICAgICAgKiBJZiBzZXR0aW5ncy5zZWxlY3RvciAhPT0gbnVsbCBhbmQgc2V0dGluZ3MuaXNDb250YWluZXIgPT0gZmFsc2UNCiAgICAgICAgICAgICAqICRlbGVtZW50LmZpcnN0KCkgaXMgc2VsZWN0ZWQgYXMgbmF2aWdhdGlvbiBpdGVtDQogICAgICAgICAgICAgKg0KICAgICAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IHNldHRpbmdzIHNldHRpbmdzIG9mIG5hdmlnYXRpb24gaXRlbQ0KICAgICAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGl0ZW1TZXR0aW5ncyAgIGh0bWwgYXR0cmlidXRlcyBvZiBuYXZpZ2F0aW9uIGl0ZW0NCiAgICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSAkZWxlbWVudCAgICBuYXZpZ2F0aW9uIGl0ZW1zIGNvbnRhaW5lciAoalF1ZXJ5IG9iamVjdCkNCiAgICAgICAgICAgICAqIEByZXR1cm4gVGhlICdwcmV2Jy8nbmV4dCcgbmF2aWdhdGlvbiBpdGVtDQogICAgICAgICAgICAgKiBAdHlwZSBPYmplY3QNCiAgICAgICAgICAgICAqLw0KICAgICAgICAgICAgY3JlYXRlUHJldk5leHRJdGVtOiBmdW5jdGlvbihzZXR0aW5ncywgaXRlbVNldHRpbmdzLCAkZWxlbWVudCkgew0KICAgICAgICAgICAgICAgIHZhciAkaXRlbSA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgIGlzU2VsZWN0b3JFeGlzdHMgPSBzZXR0aW5ncy5zZWxlY3RvciAhPT0gbnVsbDsNCg0KDQogICAgICAgICAgICAgICAgaWYgKGlzU2VsZWN0b3JFeGlzdHMpIHsNCiAgICAgICAgICAgICAgICAgICAgJGVsZW1lbnQgPSB0aGlzLmdldEVsZW1lbnQoc2V0dGluZ3Muc2VsZWN0b3IpOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIGlmICgkZWxlbWVudCAhPT0gbnVsbCkgew0KICAgICAgICAgICAgICAgICAgICBpZiAoc2V0dGluZ3MuaXNDb250YWluZXIgfHwgIWlzU2VsZWN0b3JFeGlzdHMpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICRpdGVtID0gY3JlYXRlSXRlbSgkLmV4dGVuZCh7fSwgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICd0ZXh0Jzogc2V0dGluZ3MubGFiZWwNCiAgICAgICAgICAgICAgICAgICAgICAgIH0sIGl0ZW1TZXR0aW5ncykpOw0KICAgICAgICAgICAgICAgICAgICAgICAgKCRlbGVtZW50LmZpcnN0KCkpW3NldHRpbmdzLm1ldGhvZF0oJGl0ZW0pOw0KICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgJGl0ZW0gPSAkZWxlbWVudC5maXJzdCgpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgcmV0dXJuICRpdGVtOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9Ow0KICAgIH0oJCkpOw0KICAgIC8qKg0KICAgICAqIGVuZCBvZiBOYXZpZ2F0aW9uQnVpbGRlciBvYmplY3QNCiAgICAgKi8NCg0KICAgIC8qKg0KICAgICAqIE5hdmlnYXRpb24gY2xhc3MgaG9sZHMgbmF2aWdhdGlvbiBpdGVtcy4NCiAgICAgKiBAY29uc3RydWN0b3INCiAgICAgKi8NCiAgICBmdW5jdGlvbiBOYXZpZ2F0aW9uKCQsICR3cmFwcGVyLCBvcHRpb25zKSB7DQogICAgICAgIHZhciBkZWZhdWx0cyA9IHsNCiAgICAgICAgICAgICAgICAnaXNFbmFibGVkJzogdHJ1ZSwNCiAgICAgICAgICAgICAgICAnaGFzUHJldk5leHRJdGVtcyc6IHRydWUsDQogICAgICAgICAgICAgICAgJ2l0ZW0nOiB7DQogICAgICAgICAgICAgICAgICAgICdsYWJlbCc6ICcje2luZGV4fScsDQogICAgICAgICAgICAgICAgICAgICdzZWxlY3Rvcic6IG51bGwNCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICdwcmV2SXRlbSc6IHsNCiAgICAgICAgICAgICAgICAgICAgJ2xhYmVsJzogJzwnLA0KICAgICAgICAgICAgICAgICAgICAnc2VsZWN0b3InOiBudWxsLA0KICAgICAgICAgICAgICAgICAgICAnaXNDb250YWluZXInOiBmYWxzZQ0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgJ25leHRJdGVtJzogew0KICAgICAgICAgICAgICAgICAgICAnbGFiZWwnOiAnPicsDQogICAgICAgICAgICAgICAgICAgICdzZWxlY3Rvcic6IG51bGwsDQogICAgICAgICAgICAgICAgICAgICdpc0NvbnRhaW5lcic6IGZhbHNlDQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAnc2xpZGVzQ291bnQnOiAwDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgc2V0dGluZ3MgPSAkLmV4dGVuZCh0cnVlLCB7fSwgZGVmYXVsdHMsIG9wdGlvbnMpOw0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBqUXVlcnkgb2JqZWN0DQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgTmF2aWdhdGlvbg0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy4kID0gJDsNCiAgICAgICAgLyoqDQogICAgICAgICAqIE5hdmlnYXRpb24gaXRlbXMgKG9uZSBmb3IgZWFjaCBzbGlkZSBpZiBuYXZpZ2F0aW9uIGlzIGVuYWJsZWQpLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAbWVtYmVyIE5hdmlnYXRpb24NCiAgICAgICAgICovDQogICAgICAgIHRoaXMuJGl0ZW1zID0gJCgpOw0KICAgICAgICAvKioNCiAgICAgICAgICogTmF2aWdhdGlvbiAnbmV4dCcgaXRlbSAoaWYgcHJldi9uZXh0IGl0ZW1zIGFyZSBlbmFibGVkKS4NCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlciBOYXZpZ2F0aW9uDQogICAgICAgICAqLw0KICAgICAgICB0aGlzLiRuZXh0SXRlbSA9ICQoKTsNCiAgICAgICAgLyoqDQogICAgICAgICAqIE5hdmlnYXRpb24gJ3ByZXZpb3VzJyBpdGVtIChpZiBwcmV2L25leHQgaXRlbXMgYXJlIGVuYWJsZWQpLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAbWVtYmVyIE5hdmlnYXRpb24NCiAgICAgICAgICovDQogICAgICAgIHRoaXMuJHByZXZJdGVtID0gJCgpOw0KICAgICAgICAvKioNCiAgICAgICAgICogU2VsZWN0ZWQgaXRlbSAob25lIGZyb20gdGhpcy4kaXRlbXMgb3IgbnVsbCkuDQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgTmF2aWdhdGlvbg0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy4kc2VsZWN0ZWRJdGVtID0gbnVsbDsNCg0KICAgICAgICAvL2luaXRpYWxpemF0aW9uDQogICAgICAgIGlmIChzZXR0aW5ncy5pc0VuYWJsZWQpIHsNCiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsNCiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgc2VsZi5wcmVwYXJlSXRlbXMoc2V0dGluZ3MuaXRlbSwgc2V0dGluZ3Muc2xpZGVzQ291bnQsICR3cmFwcGVyKTsNCiAgICAgICAgICAgICAgICAvL3NlbGVjdCBmaXJzdCBpdGVtIG9uIGluaXQNCiAgICAgICAgICAgICAgICBzZWxmLnNlbGVjdEl0ZW0oMCkNCiAgICAgICAgICAgIH0sIDEwMDApOw0KDQogICAgICAgICAgICAkd3JhcHBlci5maW5kKCcubmF2JykudHJpZ2dlcignbmF2aWdhdGlvbi1jcmVhdGVkJywgdGhpcyk7DQoNCg0KICAgICAgICB9DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ1NTIGNsYXNzbSB3aGljaCB3aWxsIGJlIHVzZWQgZm9yIG1hcmsgc2VsZWN0ZWQgaXRlbQ0KICAgICAqDQogICAgICogQG1lbWJlciBOYXZpZ2F0aW9uDQogICAgICovDQogICAgTmF2aWdhdGlvbi5wcm90b3R5cGUuc2VsZWN0ZWRJdGVtQ2xhc3MgPSAnYWN0aXZlJzsNCg0KICAgIC8qKg0KICAgICAqIE1hcmsgbmF2aWdhdGlvbiBpdGVtIHdpdGggZ2l2ZW4gaW5kZXggYXMgc2VsZWN0ZWQuDQogICAgICoNCiAgICAgKiBAbWVtYmVyIE5hdmlnYXRpb24NCiAgICAgKiBAcGFyYW0ge051bWJlcn0gaW5kZXggICAgIGluZGV4IG9mIG5hdmlnYXRpb24gaXRlbQ0KICAgICAqLw0KICAgIE5hdmlnYXRpb24ucHJvdG90eXBlLnNlbGVjdEl0ZW0gPSBmdW5jdGlvbiAoaW5kZXgpIHsNCiAgICAgICAgdmFyIGNvbXBvbmVudFJvb3Q7DQogICAgICAgIGlmICh0aGlzLiRzZWxlY3RlZEl0ZW0gIT09IG51bGwpIHsNCiAgICAgICAgICAgIHRoaXMuJHNlbGVjdGVkSXRlbS5yZW1vdmVDbGFzcyh0aGlzLnNlbGVjdGVkSXRlbUNsYXNzKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHRoaXMuJHNlbGVjdGVkSXRlbSA9IHRoaXMuJGl0ZW1zLmVxKGluZGV4KS5hZGRDbGFzcyh0aGlzLnNlbGVjdGVkSXRlbUNsYXNzKTsNCiAgICAgICAgaWYgKHRoaXMuJHNlbGVjdGVkSXRlbS5sZW5ndGgpIHsNCiAgICAgICAgICAgIGNvbXBvbmVudFJvb3QgPSB0aGlzLiRzZWxlY3RlZEl0ZW0uY2xvc2VzdCgnLmNvbXBvbmVudC5jYXJvdXNlbCcpOw0KICAgICAgICAgICAgdXBkYXRlUXVlcnlQYXJhbShjb21wb25lbnRSb290LmF0dHIoJ2lkJykgfHwgImNhcm91c2VsIiwgaW5kZXgpOw0KICAgICAgICB9DQoNCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogQ3JlYXRlcyBvciBzZWxlY3RzIG5hdmlnYXRpb24gaXRlbXMgY29udGFpbmVyIGFuZCBmaWxscyBpdCB3aXRoIG5hdmlnYXRpb24gaXRlbXMuDQogICAgICogSWYgbmF2aWdhdGlvbiBpdGVtcyBjb250YWluZXIgaXMgbm90IGVtcHR5LCBjaGlsZCBlbGVtZW50cyBhcmUgYWRvcHRlZCBhcyBuYXZpZ2F0aW9uIGl0ZW1zLg0KICAgICAqIE1vZGUgb2YgYWN0aW9uIGRlcGVuZHMgb24gc2V0dGluZ3Mgb2JqZWN0Og0KICAgICAqIHZhciBzZXR0aW5ncyA9IHsNCiAgICAgKiAgICAgJ2xhYmVsJzogJyN7aW5kZXh9JywNCiAgICAgKiAgICAgJ3NlbGVjdG9yJzogbnVsbA0KICAgICAqIH07DQogICAgICogSWYgc2V0dGluZ3Muc2VsZWN0b3IgPT09IG51bGwgbmF2aWdhdGlvbiBpdGVtIGNvbnRhaW5lciBpcyBjcmVhdGVkLg0KICAgICAqIElmIHNldHRpbmdzLnNlbGVjdG9yICE9PSBudWxsIGVsZW1lbnQgdGhhdCBtYXRjaCBzZXR0aW5ncy5zZWxlY3RvciBpcyBhZGFwdGVkIGFzIG5hdmlnYWdhdGlvbiBpdGVtcyBjb250YWluZXIuDQogICAgICoNCiAgICAgKiBAbWVtYmVyIE5hdmlnYXRpb24NCiAgICAgKiBAcGFyYW0ge09iamVjdH0gc2V0dGluZ3Mgc2V0dGluZ3Mgb2YgbmF2aWdhdGlvbiBpdGVtcw0KICAgICAqIEBwYXJhbSB7TnVtYmVyfSBjb3VudCAgIG51bWJlciBvZiBuYXZpZ2F0aW9uIGl0ZW1zDQogICAgICogQHBhcmFtIHtPYmplY3R9ICR3cmFwcGVyICAgIHdyYXBwZXIgb2YgbmF2aWdhdGlvbiBpdGVtcyBjb250YWluZXIgKGpRdWVyeSBvYmplY3QpDQogICAgICogQHJldHVybiBUaGUgY29udGFpbmVyIGZpbGxlZCB3aXRoIG5hdmlnYXRpb24gaXRlbXMuDQogICAgICogQHR5cGUgT2JqZWN0DQogICAgICovDQogICAgTmF2aWdhdGlvbi5wcm90b3R5cGUucHJlcGFyZUl0ZW1zID0gZnVuY3Rpb24oc2V0dGluZ3MsIGNvdW50LCAkd3JhcHBlcikgew0KICAgICAgICB2YXIgJGNvbnRhaW5lciA9IG51bGw7DQoNCiAgICAgICAgaWYgKHNldHRpbmdzLnNlbGVjdG9yICE9PSBudWxsKSB7DQogICAgICAgICAgICAkY29udGFpbmVyID0gTmF2aWdhdGlvbkJ1aWxkZXIuZ2V0RWxlbWVudChzZXR0aW5ncy5zZWxlY3Rvcik7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAkY29udGFpbmVyID0gJCgnPGRpdi8+Jywgew0KICAgICAgICAgICAgICAgICdjbGFzcyc6ICduYXYnDQogICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICRjb250YWluZXIuYXBwZW5kVG8oJHdyYXBwZXIpOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKCRjb250YWluZXIgIT09IG51bGwpIHsNCiAgICAgICAgICAgIGlmICgkY29udGFpbmVyLmNoaWxkcmVuKCkubGVuZ3RoID09PSAwKSB7DQogICAgICAgICAgICAgICAgTmF2aWdhdGlvbkJ1aWxkZXIuY3JlYXRlSXRlbXMoJGNvbnRhaW5lciwgc2V0dGluZ3MubGFiZWwsIGNvdW50KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHRoaXMuJGl0ZW1zID0gJGNvbnRhaW5lci5jaGlsZHJlbigpLnNsaWNlKDAsIGNvdW50KTsNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiAkY29udGFpbmVyOw0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiBDcmVhdGVzIG9yIHNlbGVjdHMgbmF2aWdhdGlvbiAncHJldmlvdXMnIGFuZCAnbmV4dCcgbmF2aWdhdGlvbiBpdGVtcyAoQHNlZSBOYXZpZ2F0aW9uQnVpbGRlci5jcmVhdGVQcmV2TmV4dEl0ZW0oKSkuDQogICAgICogSWYgbmF2aWdhdGlvbiBpdGVtcyBjb250YWluZXIgaXMgbm90IGVtcHR5LCBjaGlsZCBlbGVtZW50cyBhcmUgYWRvcHRlZCBhcyBuYXZpZ2F0aW9uIGl0ZW1zLg0KICAgICAqDQogICAgICogQG1lbWJlciBOYXZpZ2F0aW9uDQogICAgICogQHBhcmFtIHtPYmplY3R9IHNldHRpbmdzIHNldHRpbmdzIG9mIG5hdmlnYXRpb24NCiAgICAgKiBAcGFyYW0ge09iamVjdH0gJGNvbnRhaW5lciAgICBuYXZpZ2F0aW9uIGl0ZW1zIGNvbnRhaW5lciAoalF1ZXJ5IG9iamVjdCkNCiAgICAgKi8NCiAgICBOYXZpZ2F0aW9uLnByb3RvdHlwZS5wcmVwYXJlUHJldk5leHRJdGVtcyA9IGZ1bmN0aW9uKHNldHRpbmdzLCAkY29udGFpbmVyKSB7DQogICAgICAgIHZhciAkaXRlbTsNCg0KICAgICAgICBzZXR0aW5ncy5wcmV2SXRlbS5tZXRob2QgPSAncHJlcGVuZCc7DQogICAgICAgICRpdGVtID0gTmF2aWdhdGlvbkJ1aWxkZXIuY3JlYXRlUHJldk5leHRJdGVtKHNldHRpbmdzLnByZXZJdGVtLCB7DQogICAgICAgICAgICAnY2xhc3MnOiAncHJldicNCiAgICAgICAgfSwgJGNvbnRhaW5lcik7DQogICAgICAgIHRoaXMuJHByZXZJdGVtID0gKCRpdGVtID09PSBudWxsKSA/IHRoaXMuJHByZXZJdGVtIDogJGl0ZW07DQoNCiAgICAgICAgc2V0dGluZ3MubmV4dEl0ZW0ubWV0aG9kID0gJ2FwcGVuZCc7DQogICAgICAgICRpdGVtID0gTmF2aWdhdGlvbkJ1aWxkZXIuY3JlYXRlUHJldk5leHRJdGVtKHNldHRpbmdzLm5leHRJdGVtLCB7DQogICAgICAgICAgICAnY2xhc3MnOiAnbmV4dCcNCiAgICAgICAgfSwgJGNvbnRhaW5lcik7DQogICAgICAgIHRoaXMuJG5leHRJdGVtID0gKCRpdGVtID09PSBudWxsKSA/IHRoaXMuJG5leHRJdGVtIDogJGl0ZW07DQogICAgfTsNCiAgICAvKioNCiAgICAgKiBlbmQgb2YgTmF2aWdhdGlvbiBjbGFzcw0KICAgICAqLw0KDQogICAgLyoqDQogICAgICogU2xpZGVyQ29udGV4dCBjbGFzcyBpcyBiaW5kZWQgdG8gYSBTbGlkZXIgY2xhc3MgaW5zdGFuY2UNCiAgICAgKiBhbmQgaG9sZHMgaXRzIHByb3BlcnRpZXMuDQogICAgICogQGNvbnN0cnVjdG9yDQogICAgICovDQogICAgZnVuY3Rpb24gU2xpZGVyQ29udGV4dCgpIHsNCiAgICAgICAgLyoqDQogICAgICAgICAqIEZsYWcsIHdoaWNoIGRldGVybWluZXMgaWYgc2xpZGUgY2FuIG9yIGNhbiBub3QgYmUgY2hhbmdlZCAoZm9yIHVzZXIgcmVxdWVzdCkNCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlciBTbGlkZXJDb250ZXh0DQogICAgICAgICAqLw0KICAgICAgICB0aGlzLmNhbkNoYW5nZVNsaWRlID0gdHJ1ZTsNCiAgICAgICAgLyoqDQogICAgICAgICAqIERlZmF1bHQgU2xpZGVyIHNldHRpbmcgb2JqZWN0IChAc2VlIFNsaWRlcikNCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlciBTbGlkZXJDb250ZXh0DQogICAgICAgICAqLw0KICAgICAgICB0aGlzLmRlZmF1bHRzID0gbnVsbDsNCiAgICAgICAgLyoqDQogICAgICAgICAqIE5hdmlnYXRpb24gb2JqZWN0IChAc2VlIE5hdmlnYXRpb24pDQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgU2xpZGVyQ29udGV4dA0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy5uYXZpZ2F0aW9uID0gbnVsbDsNCiAgICAgICAgLyoqDQogICAgICAgICAqIFNsaWRlciBvYmplY3QsIHdoaWNoIHRoaXMgY29udGV4dCBpcyBhdHRhY2VoZCB0by4NCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlciBTbGlkZXJDb250ZXh0DQogICAgICAgICAqLw0KICAgICAgICB0aGlzLm93bmVyID0gbnVsbDsNCiAgICAgICAgLyoqDQogICAgICAgICAqIEZsYWcsIHdoaWNoIGRldGVybWluZXMgaWYgY2hhbmdlIG9mIGEgc2xpZGUgY2FuIG9yIGNhbiBub3QgYmUgc2NoZWR1bGVkDQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgU2xpZGVyQ29udGV4dA0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy5wcmV2ZW50U2NoZWR1bGluZyA9IGZhbHNlOw0KICAgICAgICAvKioNCiAgICAgICAgICogU2xpZGVyIHNldHRpbmcgb2JqZWN0DQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgU2xpZGVyQ29udGV4dA0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy5zZXR0aW5ncyA9IG51bGw7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBJbnN0YW5jZSBvZiBUaW1lciBjbGFzcyAoQHNlZSBUaW1lciksIHdoaWNoIGlzIHVzZWQgdG8gc3RvcmUgaG93IG11Y2gNCiAgICAgICAgICogdGltZSBpcyBsZWZ0IHRvIGNoYW5nZSB0aGUgc2xpZGUNCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlciBTbGlkZXJDb250ZXh0DQogICAgICAgICAqLw0KICAgICAgICB0aGlzLnNsaWRlVGltZXIgPSBuZXcgVGltZXIoKTsNCiAgICAgICAgLyoqDQogICAgICAgICAqIEluc3RhbmNlIG9mIFRpbWVJbmRpY2F0b3IgY2xhc3MgKEBzZWUgVGltZUluZGljYXRvcikNCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlciBTbGlkZXJDb250ZXh0DQogICAgICAgICAqLw0KICAgICAgICB0aGlzLnRpbWVJbmRpY2F0b3IgPSBudWxsOw0KICAgICAgICAvKioNCiAgICAgICAgICogVGltZXJzIGFycmF5Lg0KICAgICAgICAgKg0KICAgICAgICAgKiBAbWVtYmVyIFNsaWRlckNvbnRleHQNCiAgICAgICAgICovDQogICAgICAgIHRoaXMudGltZXJzID0gW107DQogICAgICAgIC8qKg0KICAgICAgICAgKiBMYXN0IHRpbWVvdXQgaWRlbnRpZmllci4NCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlciBTbGlkZXJDb250ZXh0DQogICAgICAgICAqLw0KICAgICAgICB0aGlzLnRpbWVvdXRJZCA9IG51bGw7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBUcmFuc2l0aW9uIChAc2VlIFhBLmNvbXBvbmVudC5jYXJvdXNlbHMuVHJhbnNpdGlvbnMuVHJhbnNpdGlvbikgdXNlZCB3aGlsZSBjaGFuZ2luZyBzbGlkZXMNCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlciBTbGlkZXJDb250ZXh0DQogICAgICAgICAqLw0KICAgICAgICB0aGlzLnRyYW5zaXRpb24gPSBudWxsOw0KICAgICAgICAvKioNCiAgICAgICAgICogVHJhbnNpdGlvbiBzZXR0aW5ncyBvYmplY3QgKEBzZWUgWEEuY29tcG9uZW50LmNhcm91c2Vscy5UcmFuc2l0aW9ucy5UcmFuc2l0aW9uU2V0dGluZ3MpDQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgU2xpZGVyQ29udGV4dA0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy50cmFuc2l0aW9uU2V0dGluZ3MgPSBuZXcgWEEuY29tcG9uZW50LmNhcm91c2Vscy5UcmFuc2l0aW9ucy5UcmFuc2l0aW9uU2V0dGluZ3MoKTsNCiAgICAgICAgLyoqDQogICAgICAgICAqIGpRdWVyeSBvYmplY3Qgd2hpY2ggY29udGFpbnMgYWxsIHNsaWRlcw0KICAgICAgICAgKg0KICAgICAgICAgKiBAbWVtYmVyIFNsaWRlckNvbnRleHQNCiAgICAgICAgICovDQogICAgICAgIHRoaXMuJHNsaWRlcyA9IG51bGw7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBqUXVlcnkgb2JqZWN0IGNvbnRhaW5pbmcgZWxlbWVudCB0aGF0IHdyYXBwcyBzbGlkZXMNCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlciBTbGlkZXJDb250ZXh0DQogICAgICAgICAqLw0KICAgICAgICB0aGlzLiR3cmFwcGVyID0gbnVsbDsNCiAgICAgICAgLyoqDQogICAgICAgICAqIFJlZmVyZW5jZSB0byBtZXRob2QsIHdoaWNoIHNob3VsZCBjaGFuZ2UgY3VycmVudCBzbGlkZQ0KICAgICAgICAgKg0KICAgICAgICAgKiBAbWVtYmVyIFNsaWRlckNvbnRleHQNCiAgICAgICAgICovDQogICAgICAgIHRoaXMuY2hhbmdlQ3VycmVudFNsaWRlID0gbnVsbDsNCiAgICAgICAgLyoqDQogICAgICAgICAqIFJlZmVyZW5jZSB0byBtZXRob2QsIHdoaWNoIHNob3VsZCByZXR1cm4galF1ZXJ5IG9iamVjdCB3aXRoIGN1cnJlbnQgc2xpZGUNCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlciBTbGlkZXJDb250ZXh0DQogICAgICAgICAqLw0KICAgICAgICB0aGlzLmdldEN1cnJlbnRTbGlkZSA9IG51bGw7DQoNCiAgICAgICAgdGhpcy50aW1lcnMucHVzaCh0aGlzLnNsaWRlVGltZXIpOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBlbmQgb2YgU2xpZGVyQ29udGV4dCBjbGFzcw0KICAgICAqLw0KDQogICAgLyoqDQogICAgICogU2xpZGVyIGNsYXNzIG1hbmFnZXMgY2hhbmdpbmcgb2Ygc2xpZGVzLg0KICAgICAqDQogICAgICogT3B0aW9ucyBvYmplY3Q6DQogICAgICogew0KICAgICAqICAgICAnbmF2aWdhdGlvbic6IE9iamVjdCB2YWx1ZSwgLy9uYXZpZ2F0aW9uIHNldHRpbmdzIG9iamVjdA0KICAgICAqICAgICAndGltZW91dCc6IE51bWJlciB2YWx1ZSwgLy90aW1lIGJldHdlZW4gc2xpZGVzIGNoYW5naW5nDQogICAgICogICAgICd0cmFuc2l0aW9uJzogU3RyaW5nIHZhbHVlLCAvL25hbWUgb2YgdHJhbnNpdGlvbiBjbGFzcyAoQHNlZSBYQS5jb21wb25lbnQuY2Fyb3VzZWxzLlRyYW5zaXRpb25zLlRyYW5zaXRpb24pDQogICAgICogICAgICdpc1BhdXNlRW5hYmxlZCc6IEJvb2xlYW4gdmFsdWUsIC8vZmxhZywgd2hpY2ggZGV0ZXJtaW5lcyBpZiBwYXVzZSBmZWF0dXJlIGlzIGVuYWJsZWQNCiAgICAgKiAgICAgJ3RpbWVJbmRpY2F0b3InOiB7DQogICAgICogICAgICAgICAnaXNFbmFibGVkJzogQm9vbGVhbiB2YWx1ZSwgLy9mbGFnLCB3aGljaCBkZXRlcm1pbmVzIGlmIHRpbWUgaW5kaWNhdG9yIGlzIGVuYWJsZWQNCiAgICAgKiAgICAgICAgICdzZWxlY3Rvcic6IFN0cmluZyB2YWx1ZSwgLy9zZWxlY3RvciBvZiB0aW1lIGluZGljYXRvciBodG1sIGVsZW1lbnQNCiAgICAgKiAgICAgICAgICd2aWV3JzogU3RyaW5nIHZhbHVlLCAvL25hbWUgb2YgdmlldyBjbGFzcyAoQHNlZSBYQS5jb21wb25lbnQuY2Fyb3VzZWxzLkluZGljYXRvclZpZXdzLlZpZXcNCiAgICAgKiAgICAgICAgICdvcHRpb25zJzogT2JqZWN0IHZhbHVlIC8vb2JqZWN0IHdpdGggb3B0aW9ucywgd2hpY2ggd2lsbCBiZSBwYXNzZWQgdG8gYSB0aW1lIGluZGljYXRvciB2aWV3DQogICAgICogICAgIH0NCiAgICAgKiB9DQogICAgICogQGNvbnN0cnVjdG9yDQogICAgICogQHBhcmFtIHtPYmplY3R9ICQgICAgIHRoZSBqUXVlcnkgb2JqZWN0DQogICAgICogQHBhcmFtIHtTbGlkZXJDb250ZXh0fSBjb250ZXh0ICAgIGluc3RhbmNlIG9mIFNsaWRlckNvbnRleHQgY2xhc3M7IG11c3QgYmUgc2VwYXJhdGUgZm9yIGVhY2ggaW5zdGFuY2UgKEBzZWUgU2xpZGVyQ29udGV4dCkNCiAgICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucyAgICBTbGlkZXIgb3B0aW9ucyBvYmplY3QNCiAgICAgKi8NCiAgICBmdW5jdGlvbiBTbGlkZXIoJCwgY29udGV4dCwgb3B0aW9ucykgew0KICAgICAgICB2YXIgZGVmYXVsdHMgPSB7DQogICAgICAgICAgICAnbmF2aWdhdGlvbic6IHt9LA0KICAgICAgICAgICAgJ3RpbWVvdXQnOiAxMDAwMCwNCiAgICAgICAgICAgICd0cmFuc2l0aW9uJzogJ0Jhc2ljVHJhbnNpdGlvbicsDQogICAgICAgICAgICAnaXNQYXVzZUVuYWJsZWQnOiB0cnVlLA0KICAgICAgICAgICAgJ3RpbWVJbmRpY2F0b3InOiB7DQogICAgICAgICAgICAgICAgJ2lzRW5hYmxlZCc6IGZhbHNlLA0KICAgICAgICAgICAgICAgICdzZWxlY3Rvcic6IG51bGwsDQogICAgICAgICAgICAgICAgJ3ZpZXcnOiAnVmlldycsDQogICAgICAgICAgICAgICAgJ29wdGlvbnMnOiB7fQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9Ow0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBJbnN0YW5jZSBvZiBTbGlkZXJDb250ZXh0IGNsYXNzIChAc2VlIFNsaWRlckNvbnRleHQpDQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgTmF2aWdhdGlvbg0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy5jb250ZXh0ID0gY29udGV4dDsNCg0KICAgICAgICBjb250ZXh0Lm93bmVyID0gdGhpczsNCiAgICAgICAgY29udGV4dC5kZWZhdWx0cyA9IGRlZmF1bHRzOw0KICAgICAgICBjb250ZXh0LnNldHRpbmdzID0gJC5leHRlbmQodHJ1ZSwge30sIGRlZmF1bHRzLCBvcHRpb25zKTsNCiAgICAgICAgY29udGV4dC50cmFuc2l0aW9uU2V0dGluZ3MuJHNsaWRlcyA9IGNvbnRleHQuJHNsaWRlczsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBFeGVjdXRlcyBtZXRob2Qgd2l0aCBnaXZlbiBtZXRob2ROYW1lIG9uIGVhY2ggVGltZXIgaW4gY29udGV4dC50aW1lcnMgKEBzZWUgVGltZXIpDQogICAgICoNCiAgICAgKiBAbWVtYmVyIFNsaWRlcg0KICAgICAqIEBwYXJhbSB7U3RyaW5nfSBtZXRob2ROYW1lICAgbmFtZSBvZiBhIG1ldGhvZCwgd2hpY2ggd2lsbCBiZSBleGVjdXRlZCBvbiB0aW1lcnMNCiAgICAgKiBAcGFyYW0ge1NsaWRlckNvbnRleHR9IGNvbnRleHQgICAgY3VycmVudCBjb250ZXh0DQogICAgICovDQogICAgU2xpZGVyLnByb3RvdHlwZS5leGVjdXRlT25UaW1lcnMgPSBmdW5jdGlvbihtZXRob2ROYW1lLCBjb250ZXh0KSB7DQogICAgICAgIHZhciBpID0gbnVsbCwNCiAgICAgICAgICAgIHRpbWVyID0gbnVsbCwNCiAgICAgICAgICAgIHRpbWVycyA9IGNvbnRleHQudGltZXJzOw0KDQogICAgICAgIGZvciAoaSA9IDA7IGkgPCB0aW1lcnMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgIHRpbWVyID0gdGltZXJzW2ldOw0KICAgICAgICAgICAgaWYgKHR5cGVvZih0aW1lclttZXRob2ROYW1lXSkgPT09ICdmdW5jdGlvbicpIHsNCiAgICAgICAgICAgICAgICB0aW1lclttZXRob2ROYW1lXSgpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfTsNCg0KICAgIC8qKg0KICAgICAqIERlc2NoZWR1bGVzIGNoYW5nZSBvZiBhIHNsaWRlLCBieSBjbGVhcmluZyB0aW1lb3V0IHByZXZpb3VzbHkgc2V0IGJ5IHNldFRpZW1vdXQoKSBmdW5jdGlvbi4NCiAgICAgKg0KICAgICAqIEBtZW1iZXIgU2xpZGVyDQogICAgICogQHBhcmFtIHtTbGlkZXJDb250ZXh0fSBjb250ZXh0ICAgIGN1cnJlbnQgY29udGV4dA0KICAgICAqLw0KICAgIFNsaWRlci5wcm90b3R5cGUuZGVzY2hlZHVsZVNsaWRlID0gZnVuY3Rpb24oY29udGV4dCkgew0KICAgICAgICBpZiAoY29udGV4dC50aW1lb3V0SWQgIT09IG51bGwpIHsNCiAgICAgICAgICAgIGNsZWFyVGltZW91dChjb250ZXh0LnRpbWVvdXRJZCk7DQogICAgICAgICAgICBjb250ZXh0LnRpbWVvdXRJZCA9IG51bGw7DQogICAgICAgIH0NCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogU2NoZWR1bGVzIGNoYW5nZSBvZiBhIHNsaWRlLCBieSBzZXR0aW5nIHRpbWVvdXQgKHVzaW5nIHNldFRpZW1vdXQoKSBmdW5jdGlvbikgaWYgY2FuLg0KICAgICAqIElmIGNhbid0LCB0cmllcyBhZ2FpbiBhZnRlciBzaG9ydCBwZXJpb2Qgb2YgdGltZS4NCiAgICAgKg0KICAgICAqIEBtZW1iZXIgU2xpZGVyDQogICAgICogQHBhcmFtIHtTbGlkZXJDb250ZXh0fSBjb250ZXh0ICAgIGN1cnJlbnQgY29udGV4dA0KICAgICAqLw0KICAgIFNsaWRlci5wcm90b3R5cGUuc2NoZWR1bGVTbGlkZSA9IGZ1bmN0aW9uKGNvbnRleHQpIHsNCiAgICAgICAgdmFyIG93bmVyID0gY29udGV4dC5vd25lcjsNCg0KICAgICAgICBvd25lci5kZXNjaGVkdWxlU2xpZGUoY29udGV4dCk7DQoNCiAgICAgICAgaWYgKCFjb250ZXh0LnByZXZlbnRTY2hlZHVsaW5nICYmIGNvbnRleHQuJHNsaWRlcy5zaXplKCkgPiAxKSB7DQogICAgICAgICAgICBvd25lci5leGVjdXRlT25UaW1lcnMoJ3NldCcsIGNvbnRleHQpOw0KDQogICAgICAgICAgICBpZiAoY29udGV4dC5jYW5DaGFuZ2VTbGlkZSkgew0KICAgICAgICAgICAgICAgIGlmIChjb250ZXh0LnRpbWVJbmRpY2F0b3IgIT09IG51bGwpIHsNCiAgICAgICAgICAgICAgICAgICAgY29udGV4dC50aW1lSW5kaWNhdG9yLnBsYXkoKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgY29udGV4dC50aW1lb3V0SWQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICBvd25lci5jaGFuZ2VDdXJyZW50U2xpZGVCeSgxLCBjb250ZXh0KTsNCiAgICAgICAgICAgICAgICB9LCBjb250ZXh0LnNldHRpbmdzLnRpbWVvdXQgLSBjb250ZXh0LnNsaWRlVGltZXIuZWxhcHNlZCk7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgIG93bmVyLnNjaGVkdWxlU2xpZGUoY29udGV4dCk7DQogICAgICAgICAgICAgICAgfSwgMTAwKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiBDaGFuZ2VzIGN1cnJlbnQgc2xpZGUsIGJ5IG9mZnNldCBwZXJmb3JtaW5nIGNvbnRleHQudHJhbnNpdGlvbg0KICAgICAqIEFueSBvZmZzZXQgdmFsdWUgaXMgc2F2ZSAoaWYgaXQgaXMgYW4gaW50ZWdlcikuDQogICAgICoNCiAgICAgKiBAbWVtYmVyIFNsaWRlcg0KICAgICAqIEBwYXJhbSB7TnVtYmVyfSBvZmZzZXQgICAgdGhlIG9mZnNldCB0byBhbiBpbmRleCBvZiBhIG5ldyBzbGlkZQ0KICAgICAqIEBwYXJhbSB7U2xpZGVyQ29udGV4dH0gY29udGV4dCAgICBjdXJyZW50IGNvbnRleHQNCiAgICAgKi8NCiAgICBTbGlkZXIucHJvdG90eXBlLmNoYW5nZUN1cnJlbnRTbGlkZUJ5ID0gZnVuY3Rpb24ob2Zmc2V0LCBjb250ZXh0KSB7DQogICAgICAgIHZhciBzZXR0aW5ncyA9IGNvbnRleHQudHJhbnNpdGlvblNldHRpbmdzLA0KICAgICAgICAgICAgJGN1cnJlbnRTbGlkZSA9IGNvbnRleHQuZ2V0Q3VycmVudFNsaWRlKCksDQogICAgICAgICAgICAkc2xpZGVzID0gY29udGV4dC4kc2xpZGVzOw0KDQogICAgICAgIGlmICgob2Zmc2V0ICUgJHNsaWRlcy5zaXplKCkpICE9PSAwKSB7DQogICAgICAgICAgICBjb250ZXh0LmNhbkNoYW5nZVNsaWRlID0gZmFsc2U7DQoNCiAgICAgICAgICAgIHNldHRpbmdzLm9mZnNldCA9IG9mZnNldDsNCiAgICAgICAgICAgIHNldHRpbmdzLiRjdXJyZW50U2xpZGUgPSAkY3VycmVudFNsaWRlOw0KICAgICAgICAgICAgc2V0dGluZ3MuJG5leHRTbGlkZSA9ICRzbGlkZXMuZXEoKCRjdXJyZW50U2xpZGUuaW5kZXgoKSArIG9mZnNldCkgJSAkc2xpZGVzLnNpemUoKSk7DQoNCiAgICAgICAgICAgIGNvbnRleHQuY2hhbmdlQ3VycmVudFNsaWRlKHNldHRpbmdzLiRuZXh0U2xpZGUpOw0KICAgICAgICAgICAgY29udGV4dC50cmFuc2l0aW9uLnBlcmZvcm0oY29udGV4dC50cmFuc2l0aW9uU2V0dGluZ3MpOw0KICAgICAgICAgICAgY29udGV4dC5vd25lci5leGVjdXRlT25UaW1lcnMoJ3Jlc2V0JywgY29udGV4dCk7DQogICAgICAgIH0NCg0KDQogICAgICAgIHZhciAkY2Fyb3VzZWwgPSAkKGNvbnRleHQuJHdyYXBwZXIpLnBhcmVudHMoIi5jYXJvdXNlbCIpOw0KICAgICAgICAkY2Fyb3VzZWwudHJpZ2dlcigic2xpZGUtY2hhbmdlZCIpOw0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiBTdGFydHMgYXV0b21hdGljIHNsaWRlcyBjaGFuZ2luZw0KICAgICAqDQogICAgICogQG1lbWJlciBTbGlkZXINCiAgICAgKi8NCiAgICBTbGlkZXIucHJvdG90eXBlLnJ1biA9IGZ1bmN0aW9uKCkgew0KICAgICAgICB0aGlzLmV4ZWN1dGVPblRpbWVycygncmVzZXQnLCB0aGlzLmNvbnRleHQpOw0KICAgICAgICB0aGlzLnNjaGVkdWxlU2xpZGUodGhpcy5jb250ZXh0KTsNCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogQ2FuY2VsIHRoZSBkZWZhdWx0IGFjdGlvbiBvZiBldmVudCBhbmQgY2hhbmdlcyBzbGlkZSBtYW51YWxseS4NCiAgICAgKg0KICAgICAqIEBtZW1iZXIgU2xpZGVyDQogICAgICogQHBhcmFtIHtPYmplY3R9IGV2ZW50ICAgICB0aGUgZXZlbnQNCiAgICAgKiBAcGFyYW0ge051bWJlcn0gb2Zmc2V0ICAgIHRoZSBvZmZzZXQgdG8gYW4gaW5kZXggb2YgYSBuZXcgc2xpZGUNCiAgICAgKiBAcGFyYW0ge1NsaWRlckNvbnRleHR9IGNvbnRleHQgICAgY3VycmVudCBjb250ZXh0DQogICAgICovDQogICAgU2xpZGVyLnByb3RvdHlwZS5vbkNoYW5nZUN1cnJlbnRTbGlkZSA9IGZ1bmN0aW9uKGV2ZW50LCBvZmZzZXQsIGNvbnRleHQpIHsNCiAgICAgICAgdmFyIG93bmVyID0gY29udGV4dC5vd25lcjsNCg0KICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgICBpZiAoY29udGV4dC5jYW5DaGFuZ2VTbGlkZSkgew0KICAgICAgICAgICAgb3duZXIuZGVzY2hlZHVsZVNsaWRlKGNvbnRleHQpOw0KICAgICAgICAgICAgb3duZXIuY2hhbmdlQ3VycmVudFNsaWRlQnkob2Zmc2V0LCBjb250ZXh0KTsNCiAgICAgICAgfQ0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiBTZWxlY3RzIG5hdmlnYXRpb24gaXRlbSB3aXRoIGdpdmVuIGluZGV4Lg0KICAgICAqDQogICAgICogQG1lbWJlciBTbGlkZXINCiAgICAgKiBAcGFyYW0ge051bWJlcn0gaW5kZXggICAgIHRoZSBpbmRleCBvZiBuYXZpZ2F0aW9uIGl0ZW0NCiAgICAgKi8NCiAgICBTbGlkZXIucHJvdG90eXBlLnNlbGVjdE5hdmlnYXRpb25JdGVtID0gZnVuY3Rpb24oaW5kZXgpIHsNCiAgICAgICAgdGhpcy5jb250ZXh0Lm5hdmlnYXRpb24uc2VsZWN0SXRlbShpbmRleCk7DQogICAgfTsNCiAgICAvKioNCiAgICAgKiBlbmQgb2YgU2xpZGVyIGNsYXNzDQogICAgICovDQoNCiAgICAvKioNCiAgICAgKiBTbGlkZXJJbml0aWFsaXplciBvYmplY3Qgc2V0IHVwIGluc3RhbmNlcyBvZiBTbGlkZXIgY2xhc3MNCiAgICAgKi8NCiAgICBTbGlkZXJJbml0aWFsaXplciA9IChmdW5jdGlvbigkKSB7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBBdHRhY2hlcyBldmVudHMgdG8gbmF2aWdhdGlvbiBpdGVtcy4NCiAgICAgICAgICoNCiAgICAgICAgICogQHBhcmFtIHtTbGlkZXJDb250ZXh0fSBjb250ZXh0ICAgYSBjb250ZXh0IG9mIGEgU2xpZGVyIGNsYXNzIGluc3RhbmNlDQogICAgICAgICAqLw0KICAgICAgICBmdW5jdGlvbiBhdHRhY2hOYXZpZ2F0aW9uRXZlbnRzKGNvbnRleHQpIHsNCiAgICAgICAgICAgIHZhciBvd25lciA9IGNvbnRleHQub3duZXIsDQogICAgICAgICAgICAgICAgJG5hdkxpbmtzID0gY29udGV4dC4kd3JhcHBlci5maW5kKCIubmF2IGEiKSwNCiAgICAgICAgICAgICAgICAkcHJldkl0ZW1UeHQgPSBjb250ZXh0LiR3cmFwcGVyLmZpbmQoJy5wcmV2LXRleHQnKSwNCiAgICAgICAgICAgICAgICAkbmV4dEl0ZW1UeHQgPSBjb250ZXh0LiR3cmFwcGVyLmZpbmQoJy5uZXh0LXRleHQnKTsNCg0KICAgICAgICAgICAgY29udGV4dC5uYXZpZ2F0aW9uLiRpdGVtcy5lYWNoKGZ1bmN0aW9uKGluZGV4KSB7DQogICAgICAgICAgICAgICAgdmFyICRzbGlkZSA9IGNvbnRleHQuJHNsaWRlcy5lcShpbmRleCk7DQoNCiAgICAgICAgICAgICAgICAkKHRoaXMpLmNsaWNrKGZ1bmN0aW9uKGV2ZW50KSB7DQogICAgICAgICAgICAgICAgICAgIG93bmVyLm9uQ2hhbmdlQ3VycmVudFNsaWRlKGV2ZW50LCAkc2xpZGUuaW5kZXgoKSAtIGNvbnRleHQuZ2V0Q3VycmVudFNsaWRlKCkuaW5kZXgoKSwgY29udGV4dCk7DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgJHByZXZJdGVtVHh0LmNsaWNrKGZ1bmN0aW9uKGV2ZW50KSB7DQogICAgICAgICAgICAgICAgb3duZXIub25DaGFuZ2VDdXJyZW50U2xpZGUoZXZlbnQsIC0xLCBjb250ZXh0KTsNCiAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICAkbmV4dEl0ZW1UeHQuY2xpY2soZnVuY3Rpb24oZXZlbnQpIHsNCiAgICAgICAgICAgICAgICBvd25lci5vbkNoYW5nZUN1cnJlbnRTbGlkZShldmVudCwgMSwgY29udGV4dCk7DQogICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgY29udGV4dC5uYXZpZ2F0aW9uLiRwcmV2SXRlbS5jbGljayhmdW5jdGlvbihldmVudCkgew0KICAgICAgICAgICAgICAgIG93bmVyLm9uQ2hhbmdlQ3VycmVudFNsaWRlKGV2ZW50LCAtMSwgY29udGV4dCk7DQogICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgY29udGV4dC5uYXZpZ2F0aW9uLiRuZXh0SXRlbS5jbGljayhmdW5jdGlvbihldmVudCkgew0KICAgICAgICAgICAgICAgIG93bmVyLm9uQ2hhbmdlQ3VycmVudFNsaWRlKGV2ZW50LCAxLCBjb250ZXh0KTsNCiAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICAkbmF2TGlua3Mub24oImtleWRvd24iLCBmdW5jdGlvbihldmVudCkgew0KICAgICAgICAgICAgICAgIHN3aXRjaCAoZXZlbnQua2V5Q29kZSkgew0KICAgICAgICAgICAgICAgICAgICBjYXNlIDM3Og0KICAgICAgICAgICAgICAgICAgICAgICAgb3duZXIub25DaGFuZ2VDdXJyZW50U2xpZGUoZXZlbnQsIC0xLCBjb250ZXh0KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykucGFyZW50KCkuZmluZCgiLmFjdGl2ZSIpLmZvY3VzKCk7DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAzOToNCiAgICAgICAgICAgICAgICAgICAgICAgIG93bmVyLm9uQ2hhbmdlQ3VycmVudFNsaWRlKGV2ZW50LCAxLCBjb250ZXh0KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykucGFyZW50KCkuZmluZCgiLmFjdGl2ZSIpLmZvY3VzKCk7DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBBdHRhY2hlcyBwYXVzZSBldmVudCB0byBuYXZpZ2F0aW9uIHdyYXBwZXIuDQogICAgICAgICAqDQogICAgICAgICAqIEBwYXJhbSB7U2xpZGVyQ29udGV4dH0gY29udGV4dCAgIGEgY29udGV4dCBvZiBhIFNsaWRlciBjbGFzcyBpbnN0YW5jZQ0KICAgICAgICAgKi8NCiAgICAgICAgZnVuY3Rpb24gYXR0YWNoUGF1c2VFdmVudChjb250ZXh0KSB7DQogICAgICAgICAgICB2YXIgb3duZXIgPSBjb250ZXh0Lm93bmVyLA0KICAgICAgICAgICAgICAgICRlbGVtZW50ID0gY29udGV4dC4kd3JhcHBlciwNCiAgICAgICAgICAgICAgICAkbmF2TGlua3MgPSAkZWxlbWVudC5maW5kKCIubmF2IGEiKTsNCg0KICAgICAgICAgICAgdmFyIGNhbGxiYWNrTW91c2VlbnRlciA9IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgIGNvbnRleHQucHJldmVudFNjaGVkdWxpbmcgPSB0cnVlOw0KICAgICAgICAgICAgICAgIG93bmVyLmRlc2NoZWR1bGVTbGlkZShjb250ZXh0KTsNCg0KICAgICAgICAgICAgICAgIG93bmVyLmV4ZWN1dGVPblRpbWVycygndXBkYXRlJywgY29udGV4dCk7DQogICAgICAgICAgICAgICAgaWYgKGNvbnRleHQudGltZUluZGljYXRvciAhPT0gbnVsbCkgew0KICAgICAgICAgICAgICAgICAgICBjb250ZXh0LnRpbWVJbmRpY2F0b3IucGF1c2UoKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICRlbGVtZW50Lm1vdXNlZW50ZXIoY2FsbGJhY2tNb3VzZWVudGVyKTsNCiAgICAgICAgICAgICRuYXZMaW5rcy5vbigiZm9jdXMiLCBjYWxsYmFja01vdXNlZW50ZXIpOw0KDQogICAgICAgICAgICB2YXIgY2FsbGJhY2tNb3VzZUxlYXZlID0gZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgY29udGV4dC5wcmV2ZW50U2NoZWR1bGluZyA9IGZhbHNlOw0KICAgICAgICAgICAgICAgIG93bmVyLnNjaGVkdWxlU2xpZGUoY29udGV4dCk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICRlbGVtZW50Lm1vdXNlbGVhdmUoY2FsbGJhY2tNb3VzZUxlYXZlKTsNCiAgICAgICAgICAgICRuYXZMaW5rcy5vbigiYmx1ciIsIGNhbGxiYWNrTW91c2VMZWF2ZSk7DQogICAgICAgIH0NCg0KICAgICAgICAvKioNCiAgICAgICAgICogQ3JlYXRlcyB0aW1lIGluZGljYXRvciB2aWV3DQogICAgICAgICAqDQogICAgICAgICAqIEBwYXJhbSB7U2xpZGVyQ29udGV4dH0gY29udGV4dCAgIGEgY29udGV4dCBvZiBhIFNsaWRlciBjbGFzcyBpbnN0YW5jZQ0KICAgICAgICAgKi8NCiAgICAgICAgZnVuY3Rpb24gY3JlYXRlSW5kaWNhdG9yKGNvbnRleHQpIHsNCiAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IGNvbnRleHQuc2V0dGluZ3MsDQogICAgICAgICAgICAgICAgdGltZUluZGljYXRvciA9IG51bGwsDQogICAgICAgICAgICAgICAgVmlld0NvbnN0cnVjdG9yID0gWEEuY29tcG9uZW50LmNhcm91c2Vscy5JbmRpY2F0b3JWaWV3c1tzZXR0aW5ncy50aW1lSW5kaWNhdG9yLnZpZXddLA0KICAgICAgICAgICAgICAgIHZpZXcgPSBudWxsOw0KDQogICAgICAgICAgICBpZiAoVmlld0NvbnN0cnVjdG9yICE9PSBudWxsKSB7DQogICAgICAgICAgICAgICAgdmlldyA9IG5ldyBWaWV3Q29uc3RydWN0b3Ioc2V0dGluZ3MudGltZUluZGljYXRvci5zZWxlY3Rvciwgc2V0dGluZ3MudGltZUluZGljYXRvci5vcHRpb25zKTsNCiAgICAgICAgICAgICAgICB0aW1lSW5kaWNhdG9yID0gbmV3IFRpbWVJbmRpY2F0b3IoJCwgdmlldywgc2V0dGluZ3MudGltZW91dCk7DQogICAgICAgICAgICAgICAgY29udGV4dC50aW1lSW5kaWNhdG9yID0gdGltZUluZGljYXRvcjsNCiAgICAgICAgICAgICAgICBjb250ZXh0LnRpbWVycy5wdXNoKHRpbWVJbmRpY2F0b3IpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIEF0dGFjaGVzIGV2ZW50cyB0byBuYXZpZ2F0aW9uLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAcGFyYW0ge1NsaWRlckNvbnRleHR9IGNvbnRleHQgICBhIGNvbnRleHQgb2YgYSBTbGlkZXIgY2xhc3MgaW5zdGFuY2UNCiAgICAgICAgICovDQogICAgICAgIGZ1bmN0aW9uIGluaXRpYWxpemVOYXZpZ2F0aW9uKGNvbnRleHQpIHsNCiAgICAgICAgICAgIGNvbnRleHQuc2V0dGluZ3MubmF2aWdhdGlvbi5zbGlkZXNDb3VudCA9IGNvbnRleHQuJHNsaWRlcy5sZW5ndGg7DQogICAgICAgICAgICBjb250ZXh0Lm5hdmlnYXRpb24gPSBuZXcgTmF2aWdhdGlvbigkLCBjb250ZXh0LiR3cmFwcGVyLCBjb250ZXh0LnNldHRpbmdzLm5hdmlnYXRpb24pOw0KDQogICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgIGF0dGFjaE5hdmlnYXRpb25FdmVudHMoY29udGV4dCk7DQogICAgICAgICAgICB9LCAxMDAwKTsNCg0KDQogICAgICAgICAgICBpZiAoY29udGV4dC5zZXR0aW5ncy5pc1BhdXNlRW5hYmxlZCkgew0KICAgICAgICAgICAgICAgIGF0dGFjaFBhdXNlRXZlbnQoY29udGV4dCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvKioNCiAgICAgICAgICogSW5pdGlhbGl6ZXMgdHJhbnNpdGlvbiBmb3IgYSBnaXZlbiBjb250ZXh0Lg0KICAgICAgICAgKg0KICAgICAgICAgKiBAcGFyYW0ge1NsaWRlckNvbnRleHR9IGNvbnRleHQgICBhIGNvbnRleHQgb2YgYSBTbGlkZXIgY2xhc3MgaW5zdGFuY2UNCiAgICAgICAgICovDQogICAgICAgIGZ1bmN0aW9uIGluaXRpYWxpemVUcmFuc2l0aW9uKGNvbnRleHQpIHsNCiAgICAgICAgICAgIHZhciBUcmFuc2l0aW9uQ29uc3RydWN0b3IgPSBudWxsLA0KICAgICAgICAgICAgICAgIG93bmVyID0gY29udGV4dC5vd25lcjsNCg0KICAgICAgICAgICAgY29udGV4dC50cmFuc2l0aW9uU2V0dGluZ3MuY2FsbGJhY2sgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICBjb250ZXh0LmNhbkNoYW5nZVNsaWRlID0gdHJ1ZTsNCg0KICAgICAgICAgICAgICAgIGlmIChjb250ZXh0LnByZXZlbnRTY2hlZHVsaW5nKSB7DQogICAgICAgICAgICAgICAgICAgIG93bmVyLmV4ZWN1dGVPblRpbWVycygncmVzZXQnLCBjb250ZXh0KTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBvd25lci5zY2hlZHVsZVNsaWRlKGNvbnRleHQpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH07DQoNCiAgICAgICAgICAgIFRyYW5zaXRpb25Db25zdHJ1Y3RvciA9IFhBLmNvbXBvbmVudC5jYXJvdXNlbHMuVHJhbnNpdGlvbnNbY29udGV4dC5zZXR0aW5ncy50cmFuc2l0aW9uXTsNCiAgICAgICAgICAgIGlmICgoVHJhbnNpdGlvbkNvbnN0cnVjdG9yID09PSBudWxsKSB8fCAoVHJhbnNpdGlvbkNvbnN0cnVjdG9yID09PSB1bmRlZmluZWQpKSB7DQogICAgICAgICAgICAgICAgVHJhbnNpdGlvbkNvbnN0cnVjdG9yID0gWEEuY29tcG9uZW50LmNhcm91c2Vscy5UcmFuc2l0aW9uc1tjb250ZXh0LmRlZmF1bHRzLnRyYW5zaXRpb25dOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY29udGV4dC50cmFuc2l0aW9uID0gbmV3IFRyYW5zaXRpb25Db25zdHJ1Y3RvcigpOw0KICAgICAgICAgICAgY29udGV4dC50cmFuc2l0aW9uLmluaXQoY29udGV4dC50cmFuc2l0aW9uU2V0dGluZ3MpOw0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgIC8qKg0KICAgICAgICAgICAgICogSW5pdGlhbGl6ZXMgU2xpZGVyIG9iamVjdCB3aXRoIGEgZ2l2ZW4gY29udGV4dC4NCiAgICAgICAgICAgICAqDQogICAgICAgICAgICAgKiBAcGFyYW0ge1NsaWRlckNvbnRleHR9IGNvbnRleHQgICBhIGNvbnRleHQgb2YgYSBTbGlkZXIgY2xhc3MgaW5zdGFuY2UNCiAgICAgICAgICAgICAqLw0KICAgICAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oY29udGV4dCkgew0KICAgICAgICAgICAgICAgIGluaXRpYWxpemVOYXZpZ2F0aW9uKGNvbnRleHQpOw0KICAgICAgICAgICAgICAgIGluaXRpYWxpemVUcmFuc2l0aW9uKGNvbnRleHQpOw0KDQogICAgICAgICAgICAgICAgaWYgKGNvbnRleHQuc2V0dGluZ3MudGltZUluZGljYXRvci5pc0VuYWJsZWQpIHsNCiAgICAgICAgICAgICAgICAgICAgY3JlYXRlSW5kaWNhdG9yKGNvbnRleHQpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfTsNCiAgICB9KCQpKTsNCiAgICAvKioNCiAgICAgKiBlbmQgb2YgU2xpZGVySW5pdGlhbGl6ZXINCiAgICAgKi8NCg0KICAgIC8qKg0KICAgICAqIENhcm91c2VsIGNsYXNzIGRpc3BsYXlzIG9uZSBzbGlkZSAoc29tZSBjb250ZW50KSBhdCB0aGUgdGltZS4NCiAgICAgKiBJdHMgYmVoYXZpb3VyIGRlcGVuZHMgb24gc2V0dGluZ3MgKHBhc3NlZCB0byBpbml0KCkgbWV0aG9kKS4NCiAgICAgKiBGb3IgbW9yZSBkZXRhaWxzIEBzZWUgU2xpZGVyLCBAc2VlIFNsaWRlckluaXRpYWxpemVyLCBAc2VlIE5hdmlnYXRpb24sDQogICAgICogQHNlZSBOYXZpZ2F0aW9uQnVpbGRlciwgQHNlZSBYQS5jb21wb25lbnQuY2Fyb3VzZWxzLlRyYW5zaXRpb25zLlRyYW5zaXRpb24sDQogICAgICogQHNlZSBYQS5jb21wb25lbnQuY2Fyb3VzZWxzLkluZGljYXRvclZpZXdzLlZpZXcNCiAgICAgKg0KICAgICAqIEBjb25zdHJ1Y3Rvcg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIENhcm91c2VsKCkgew0KICAgICAgICB2YXIgY29udGV4dCA9IHRoaXM7DQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIEluc3RhbmNlIG9mIGEgU2xpZGVyIGNsYXNzIChAc2VlIFNsaWRlcikuDQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgQ2Fyb3VzZWwNCiAgICAgICAgICovDQogICAgICAgIHRoaXMuc2xpZGVyID0gbnVsbDsNCiAgICAgICAgLyoqDQogICAgICAgICAqIERpc3BsYXllZCBzbGlkZSAoalF1ZXJ5IG9iamVjdCkuDQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgQ2Fyb3VzZWwNCiAgICAgICAgICovDQogICAgICAgIHRoaXMuJGN1cnJlbnRTbGlkZSA9IG51bGw7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBBbGwgc2xpZGVzIChqUXVlcnkgb2JqZWN0KS4NCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlciBDYXJvdXNlbA0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy4kc2xpZGVzID0gbnVsbDsNCg0KICAgICAgICAvKioNCiAgICAgICAgICogQ2hhbmdlcyBjdXJyZW50IHNsaWRlIHRvIGEgJG5ld1NsaWRlLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAbWVtYmVyIENhcm91c2VsDQogICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSAkbmV3U2xpZGUgIHRoZSBuZXcgc2xpZGUgKGpRdWVyeSkgb2JqZWN0Lg0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy5jaGFuZ2VDdXJyZW50U2xpZGUgPSBmdW5jdGlvbigkbmV3U2xpZGUpIHsNCiAgICAgICAgICAgIGNvbnRleHQuJGN1cnJlbnRTbGlkZSA9ICRuZXdTbGlkZTsNCiAgICAgICAgICAgIGNvbnRleHQuc2xpZGVyLnNlbGVjdE5hdmlnYXRpb25JdGVtKCRuZXdTbGlkZS5pbmRleCgpKTsNCiAgICAgICAgfTsNCg0KICAgICAgICAvKioNCiAgICAgICAgICogUmV0dXJucyBjdXJyZW50IHNsaWRlLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAbWVtYmVyIENhcm91c2VsDQogICAgICAgICAqIEByZXR1cm4gY3VycmVudCBzbGlkZSAoalF1ZXJ5KSBvYmplY3QuDQogICAgICAgICAqIEB0eXBlIE9iamVjdA0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy5nZXRDdXJyZW50U2xpZGUgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgIHJldHVybiBjb250ZXh0LiRjdXJyZW50U2xpZGU7DQogICAgICAgIH07DQoNCiAgICAgICAgdGhpcy5kYXRhID0ge307DQogICAgfQ0KDQogICAgLyoqDQogICAgICogUmVzZXRzIHRoZSBjYXJvdXNlbC4NCiAgICAgKg0KICAgICAqIEBtZW1iZXIgQ2Fyb3VzZWwNCiAgICAgKi8NCiAgICBDYXJvdXNlbC5wcm90b3R5cGUucmVzZXQgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgdGhpcy4kc2xpZGVzLmVhY2goZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAkKHRoaXMpLmhpZGUoKTsNCiAgICAgICAgfSk7DQoNCiAgICAgICAgdGhpcy5jaGFuZ2VDdXJyZW50U2xpZGUodGhpcy4kc2xpZGVzLmZpcnN0KCkpOw0KICAgICAgICB0aGlzLiRjdXJyZW50U2xpZGUuc2hvdygpOw0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiBJbml0aWFsaXplcyB0aGUgY2Fyb3VzZWwuDQogICAgICogV3JhcHBzIGNhcm91c2VsIGNvbnRlbnQgd2l0aCA8ZGl2IGNsYXNzPSJ3cmFwcGVyIiAvPiBlbGVtZW50LA0KICAgICAqIHNlbGVjdHMgc2xpZGVzICg8bGkgLz4gZWxlbWVudHMpIGZyb20gPHVsIGNsYXNzPSJzbGlkZXMiIC8+IGVsZW1lbnQsDQogICAgICogaW5pdGlhbGl6ZXMgU2xpZGVyIGNsYXNzIGluY3RhbmNlLCByZXNldHMgdGhlIGNhcm91c2VsIGFuZCBzdGFydCBhdXRvbWF0aWMgc2xpZGVzIGNoYW5naW5nLg0KICAgICAqDQogICAgICogQG1lbWJlciBDYXJvdXNlbA0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSAkY29udGFpbmVyICAgICBqUXVlcnkgb2JqZWN0IHdpdGggYSBtYWluIGh0bWwgZWxlbWVudCBvZiB0aGUgY2Fyb3VzZWwNCiAgICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucyAgICAgY2Fyb3VzZWwgb3B0aW9ucyBvYmplY3QNCiAgICAgKi8NCiAgICBDYXJvdXNlbC5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uKCRjb250YWluZXIsIG9wdGlvbnMpIHsNCiAgICAgICAgdmFyICR3cmFwcGVyID0gJCgnPGRpdi8+Jywgew0KICAgICAgICAgICAgICAgICdjbGFzcyc6ICd3cmFwcGVyJw0KICAgICAgICAgICAgfSksDQogICAgICAgICAgICBzbGlkZXJDb250ZXh0ID0gbnVsbDsNCg0KICAgICAgICAkd3JhcHBlci5hcHBlbmQoJGNvbnRhaW5lci5jaGlsZHJlbigpLmRldGFjaCgpKTsNCiAgICAgICAgJGNvbnRhaW5lci5hcHBlbmQoJHdyYXBwZXIpOw0KICAgICAgICB0aGlzLiRzbGlkZXMgPSAkY29udGFpbmVyLmZpbmQoJy5zbGlkZXMgbGkuc2xpZGUnKTsNCg0KICAgICAgICBzbGlkZXJDb250ZXh0ID0gbmV3IFNsaWRlckNvbnRleHQoKTsNCiAgICAgICAgc2xpZGVyQ29udGV4dC5jaGFuZ2VDdXJyZW50U2xpZGUgPSB0aGlzLmNoYW5nZUN1cnJlbnRTbGlkZTsNCiAgICAgICAgc2xpZGVyQ29udGV4dC5nZXRDdXJyZW50U2xpZGUgPSB0aGlzLmdldEN1cnJlbnRTbGlkZTsNCiAgICAgICAgc2xpZGVyQ29udGV4dC4kc2xpZGVzID0gdGhpcy4kc2xpZGVzOw0KICAgICAgICBzbGlkZXJDb250ZXh0LiR3cmFwcGVyID0gJHdyYXBwZXI7DQoNCiAgICAgICAgdGhpcy5zbGlkZXIgPSBuZXcgU2xpZGVyKCQsIHNsaWRlckNvbnRleHQsIG9wdGlvbnMpOw0KICAgICAgICBTbGlkZXJJbml0aWFsaXplci5pbml0aWFsaXplKHNsaWRlckNvbnRleHQpOw0KDQogICAgICAgIHRoaXMucmVzZXQoKTsNCiAgICAgICAgdGhpcy5zbGlkZXIucnVuKCk7DQogICAgfTsNCiAgICAvKioNCiAgICAgKiBlbmQgb2YgQ2Fyb3VzZWwgY2xhc3MNCiAgICAgKi8NCg0KICAgIC8qKg0KICAgICAqIFJlZ2lzdGVycyBlYWNoIGVsZW1lbnRzIHRoYXQgbWF0Y2ggdGhlIHByb3ZpZGVkIHNlbGVjdG9yIGFzIGEgY2Fyb3VzZWwgd2l0aCBhIGdpdmVuIG9wdGlvbnMuDQogICAgICogQ2Fyb3VzZWwgb3B0aW9ucyBvYmplY3QgOg0KICAgICAqIHsNCiAgICAgKiAgICAgLy8NCiAgICAgKiAgICAgLy8gbmF2aWdhdGlvbjogT2JqZWN0DQogICAgICogICAgIC8vDQogICAgICogICAgIC8vIFRoZSBuYXZpZ2F0aW9uIGNvbmZpZ3VyYXRpb24gb2JqZWN0Lg0KICAgICAqICAgICAvLw0KICAgICAqICAgICAnbmF2aWdhdGlvbic6IHsNCiAgICAgKiAgICAgICAgIC8vDQogICAgICogICAgICAgICAvL2lzRW5hYmxlZDogQm9vbGVhbg0KICAgICAqICAgICAgICAgLy8NCiAgICAgKiAgICAgICAgIC8vIFNldHMgd2hldGhlciB0aGUgbmF2aWdhdGlvbiBpcyBlbmFibGVkLg0KICAgICAqICAgICAgICAgLy8NCiAgICAgKiAgICAgICAgICdpc0VuYWJsZWQnOiB0cnVlLA0KICAgICAqICAgICAgICAgLy8NCiAgICAgKiAgICAgICAgIC8vIGhhc1ByZXZOZXh0SXRlbXM6IEJvb2xlYW4NCiAgICAgKiAgICAgICAgIC8vDQogICAgICogICAgICAgICAvLyBTZXRzIHdoZXRoZXIgdGhlIG5hdmlnYXRpb24gaGFzIHByZXZpb3VzIGFuZCBuZXh0IGJ1dHRvbnMuDQogICAgICogICAgICAgICAvLw0KICAgICAqICAgICAgICAgJ2hhc1ByZXZOZXh0SXRlbXMnOiB0cnVlLA0KICAgICAqICAgICAgICAgLy8NCiAgICAgKiAgICAgICAgIC8vIGl0ZW06IE9iamVjdA0KICAgICAqICAgICAgICAgLy8NCiAgICAgKiAgICAgICAgIC8vIE5hdmlnYXRpb24gaXRlbSBjb25maWd1cmF0aW9uIG9iamVjdC4NCiAgICAgKiAgICAgICAgIC8vDQogICAgICogICAgICAgICAnaXRlbSc6IHsNCiAgICAgKiAgICAgICAgICAgICAvLw0KICAgICAqICAgICAgICAgICAgIC8vIGxhYmVsOiBTdHJpbmcNCiAgICAgKiAgICAgICAgICAgICAvLw0KICAgICAqICAgICAgICAgICAgIC8vIExhYmVsIHRlbXBsYXRlOyBlYWNoICcje2luZGV4fScgc3RyaW5nIHdpbGwgYmUgcmVwbGFjZWQgYnkgdGhlIG51bWJlciBvZiBhIHNsaWRlLg0KICAgICAqICAgICAgICAgICAgIC8vDQogICAgICogICAgICAgICAgICAgJ2xhYmVsJzogJyN7aW5kZXh9JywNCiAgICAgKiAgICAgICAgICAgICAvLw0KICAgICAqICAgICAgICAgICAgIC8vIHNlbGVjdG9yOiBTdHJpbmcNCiAgICAgKiAgICAgICAgICAgICAvLw0KICAgICAqICAgICAgICAgICAgIC8vIE5hdmlnYXRpb24gaXRlbXMgY29udGFpbmVyIHNlbGVjdG9yOyBpZiBlcXVhbHMgbnVsbCwgdGhlIGNvbnRhaW5lciB3aWxsIGJlIGdlbmVyYXRlZA0KICAgICAqICAgICAgICAgICAgIC8vICgnZGl2JyBlbGVtZW50IHdpdGggJ25hdicgY2xhc3MgYXR0cmlidXRlIGluc2lkZSB0aGUgY2Fyb3VzZWwpLg0KICAgICAqICAgICAgICAgICAgIC8vDQogICAgICogICAgICAgICAgICAgJ3NlbGVjdG9yJzogbnVsbA0KICAgICAqICAgICAgICB9LA0KICAgICAqICAgICAgICAgLy8NCiAgICAgKiAgICAgICAgIC8vIHByZXZJdGVtOiBPYmplY3QNCiAgICAgKiAgICAgICAgIC8vDQogICAgICogICAgICAgICAvLyBOYXZpZ2F0aW9uICdwcmV2aW91cyBpdGVtJyBjb25maWd1cmF0aW9uIG9iamVjdC4NCiAgICAgKiAgICAgICAgIC8vDQogICAgICogICAgICAgICAncHJldkl0ZW0nOiB7DQogICAgICogICAgICAgICAgICAgLy8NCiAgICAgKiAgICAgICAgICAgICAvLyBsYWJlbDogU3RyaW5nDQogICAgICogICAgICAgICAgICAgLy8NCiAgICAgKiAgICAgICAgICAgICAvLyBUaGUgJ3ByZXZpb3VzIGl0ZW0nIGxhYmVsLg0KICAgICAqICAgICAgICAgICAgIC8vDQogICAgICogICAgICAgICAgICAgJ2xhYmVsJzogJzwnLA0KICAgICAqICAgICAgICAgICAgIC8vDQogICAgICogICAgICAgICAgICAgLy8gc2VsZWN0b3I6IFN0cmluZw0KICAgICAqICAgICAgICAgICAgIC8vDQogICAgICogICAgICAgICAgICAgLy8gTmF2aWdhdGlvbiAncHJldmlvdXMgaXRlbScgc2VsZWN0b3I7IGlmIGVxdWFscyBudWxsLCB0aGUgaXRlbSB3aWxsIGJlIGdlbmVyYXRlZA0KICAgICAqICAgICAgICAgICAgIC8vICgnYScgZWxlbWVudCB3aXRoICdwcmV2JyBjbGFzcyBhdHRyaWJ1dGUgaW5zaWRlIHRoZSBuYXZpZ2F0aW9uIGNvbnRhaW5lcikuDQogICAgICogICAgICAgICAgICAgLy8NCiAgICAgKiAgICAgICAgICAgICAnc2VsZWN0b3InOiBudWxsLA0KICAgICAqICAgICAgICAgICAgIC8vDQogICAgICogICAgICAgICAgICAgLy8gaXNDb250YWluZXI6IEJvb2xlYW4NCiAgICAgKiAgICAgICAgICAgICAvLw0KICAgICAqICAgICAgICAgICAgIC8vIFNldHMgd2hldGhlciB0aGUgZWxlbWVudCBmb3VuZCBieSBzZWxlY3RvciBzaG91bGQgYmUgdHJlYXRlZCBhcyBhIGNvbnRhaW5lciAoaWYgdHJ1ZSkNCiAgICAgKiAgICAgICAgICAgICAvLyBvciBzaG91bGQgYmUgYWRvcHRlZCBhcyBhICdwcmV2aW91cyBpdGVtJyAoaWYgZmFsc2UpLiBJZiBzZWxlY3RvciBlcXVhbHMgbnVsbCB0aGlzIHByb3BlcnR5IGlzIG1lYW5pbmdsZXNzLg0KICAgICAqICAgICAgICAgICAgIC8vDQogICAgICogICAgICAgICAgICAgJ2lzQ29udGFpbmVyJzogZmFsc2UNCiAgICAgKiAgICAgICAgIH0sDQogICAgICogICAgICAgICAvLw0KICAgICAqICAgICAgICAgLy8gbmV4dEl0ZW06IE9iamVjdA0KICAgICAqICAgICAgICAgLy8NCiAgICAgKiAgICAgICAgIC8vIE5hdmlnYXRpb24gJ25leHQgaXRlbScgY29uZmlndXJhdGlvbiBvYmplY3QuDQogICAgICogICAgICAgICAvLw0KICAgICAqICAgICAgICAgJ25leHRJdGVtJzogew0KICAgICAqICAgICAgICAgICAgIC8vDQogICAgICogICAgICAgICAgICAgLy8gbGFiZWw6IFN0cmluZw0KICAgICAqICAgICAgICAgICAgIC8vDQogICAgICogICAgICAgICAgICAgLy8gVGhlICduZXh0IGl0ZW0nIGxhYmVsLg0KICAgICAqICAgICAgICAgICAgIC8vDQogICAgICogICAgICAgICAgICAgJ2xhYmVsJzogJz4nLA0KICAgICAqICAgICAgICAgICAgIC8vDQogICAgICogICAgICAgICAgICAgLy8gc2VsZWN0b3I6IFN0cmluZw0KICAgICAqICAgICAgICAgICAgIC8vDQogICAgICogICAgICAgICAgICAgLy8gTmF2aWdhdGlvbiAnbmV4dCBpdGVtJyBzZWxlY3RvcjsgaWYgZXF1YWxzIG51bGwsIHRoZSBpdGVtIHdpbGwgYmUgZ2VuZXJhdGVkDQogICAgICogICAgICAgICAgICAgLy8gKCdhJyBlbGVtZW50IHdpdGggJ25leHQnIGNsYXNzIGF0dHJpYnV0ZSBpbnNpZGUgdGhlIG5hdmlnYXRpb24gY29udGFpbmVyKS4NCiAgICAgKiAgICAgICAgICAgICAvLw0KICAgICAqICAgICAgICAgICAgICdzZWxlY3Rvcic6IG51bGwsDQogICAgICogICAgICAgICAgICAgLy8NCiAgICAgKiAgICAgICAgICAgICAvLyBpc0NvbnRhaW5lcjogQm9vbGVhbg0KICAgICAqICAgICAgICAgICAgIC8vDQogICAgICogICAgICAgICAgICAgLy8gU2V0cyB3aGV0aGVyIHRoZSBlbGVtZW50IGZvdW5kIGJ5IHNlbGVjdG9yIHNob3VsZCBiZSB0cmVhdGVkIGFzIGEgY29udGFpbmVyIChpZiB0cnVlKQ0KICAgICAqICAgICAgICAgICAgIC8vIG9yIHNob3VsZCBiZSBhZG9wdGVkIGFzIGEgJ25leHQgaXRlbScgKGlmIGZhbHNlKS4gSWYgc2VsZWN0b3IgZXF1YWxzIG51bGwgdGhpcyBwcm9wZXJ0eSBpcyBtZWFuaW5nbGVzcy4NCiAgICAgKiAgICAgICAgICAgICAvLw0KICAgICAqICAgICAgICAgICAgICdpc0NvbnRhaW5lcic6IGZhbHNlDQogICAgICogICAgICAgICB9DQogICAgICogICAgIH0sDQogICAgICogICAgIC8vDQogICAgICogICAgIC8vIHRpbWVvdXQ6IE51bWJlcg0KICAgICAqICAgICAvLw0KICAgICAqICAgICAvLyBUaGUgaW50ZXJ2YWwgYmV0d2VlbiB0aGUgc2xpZGVzIGluIG1pbGlzZWNvbmRzLg0KICAgICAqICAgICAvLw0KICAgICAqICAgICAndGltZW91dCc6IDEwMDAwLA0KICAgICAqICAgICAvLw0KICAgICAqICAgICAvLyB0cmFuc2l0aW9uOiBTdHJpbmcNCiAgICAgKiAgICAgLy8NCiAgICAgKiAgICAgLy8gTmFtZSBvZiB0aGUgdHJhbnNpdGlvbiBjbGFzcywgd2hpY2ggd2lsbCBiZSB1c2VkLiBQb3NzaWJsZSB2YWx1ZXMgYXJlOg0KICAgICAqICAgICAvLyAtIEJhc2ljVHJhbnNpdGlvbiAtIHdpdGhvdXQgYW55IGFuaW1hdGlvbiwNCiAgICAgKiAgICAgLy8gLSBGYWRlSW5UcmFuc2l0aW9uIC0gbmV3IHNsaWRlIGZhZGVzIGluLA0KICAgICAqICAgICAvLyAtIFNsaWRlSG9yaXpvbnRhbGx5VHJhbnNpdGlvbiAtIG5ldyBzbGlkZSBtb3ZlcyBmcm9tIHJpZ2h0IChmcm9tIGxlZnQgaWYgdXNlciBzZWxlY3RzIHNsaWRlIHdpdGggbG93ZXIgaWQgb3IgY2xpY2tzIG9uICdwcmV2aW91cyBpdGVtJyksDQogICAgICogICAgIC8vIC0gU2xpZGVWZXJ0aWNhbGx5VHJhbnNpdGlvbiAtIG5ldyBzbGlkZSBtb3ZlcyBmcm9tIHRvcCAoZnJvbSBib3R0b20gaWYgdXNlciBzZWxlY3RzIHNsaWRlIHdpdGggbG93ZXIgaWQgb3IgY2xpY2tzIG9uICdwcmV2aW91cyBpdGVtJyksDQogICAgICogICAgIC8vIC0gb3RoZXIgLSBpZiBpbXBsZW1lbnRlZCAoZGVyaXZlZCBmcm9tIFhBLmNvbXBvbmVudC5jYXJvdXNlbHMuVHJhbnNpdGlvbnMuVHJhbnNpdGlvbiBjbGFzcykgYW5kIGFkZGVkIHRvIFhBLmNvbXBvbmVudC5jYXJvdXNlbHMuVHJhbnNpdGlvbnMgbW9kdWxlLg0KICAgICAqICAgICAvLw0KICAgICAqICAgICAndHJhbnNpdGlvbic6ICdCYXNpY1RyYW5zaXRpb24nLA0KICAgICAqICAgICAvLw0KICAgICAqICAgICAvLyBpc1BhdXNlRW5hYmxlZDogQm9vbGVhbg0KICAgICAqICAgICAvLw0KICAgICAqICAgICAvLyBTZXRzIHdoZXRoZXIgdGhlIHBhdXNlIGZlYXR1cmUgaXMgZW5hYmxlZC4NCiAgICAgKiAgICAgLy8gUGF1c2UgZmVhdHVyZSBwYXVzZXMgY291bnRkb3duIG9mIGNoYW5naW5nIHNsaWRlcywgd2hlbiBtb3VzZSBpcyBpbiBhIGNhcm91c2VsIGFyZWEuDQogICAgICogICAgIC8vDQogICAgICogICAgICdpc1BhdXNlRW5hYmxlZCc6IHRydWUsDQogICAgICogICAgIC8vDQogICAgICogICAgIC8vIHRpbWVJbmRpY2F0b3I6IE9iamVjdA0KICAgICAqICAgICAvLw0KICAgICAqICAgICAvLyAnVGltZSBpbmRpY2F0b3InIGNvbmZpZ3VyYXRpb24gb2JqZWN0Lg0KICAgICAqICAgICAvLw0KICAgICAqICAgICAndGltZUluZGljYXRvcic6IHsNCiAgICAgKiAgICAgICAgIC8vDQogICAgICogICAgICAgICAvLyBpc0VuYWJsZWQ6IEJvb2xlYW4NCiAgICAgKiAgICAgICAgIC8vDQogICAgICogICAgICAgICAvLyBTZXRzIHdoZXRoZXIgdGhlICd0aW1lIGluZGljYXRvcicgaXMgZW5hYmxlZC4NCiAgICAgKiAgICAgICAgIC8vDQogICAgICogICAgICAgICAnaXNFbmFibGVkJzogZmFsc2UsDQogICAgICogICAgICAgICAvLw0KICAgICAqICAgICAgICAgLy8gc2VsZWN0b3I6IFN0cmluZw0KICAgICAqICAgICAgICAgLy8NCiAgICAgKiAgICAgICAgIC8vICdUaW1lIGluZGljYXRvcicgc2VsZWN0b3IuDQogICAgICogICAgICAgICAvLw0KICAgICAqICAgICAgICAgJ3NlbGVjdG9yJzogbnVsbCwNCiAgICAgKiAgICAgICAgIC8vDQogICAgICogICAgICAgICAvLyB2aWV3OiBTdHJpbmcNCiAgICAgKiAgICAgICAgIC8vDQogICAgICogICAgICAgICAvLyBOYW1lIG9mIHRoZSB2aWV3IGNsYXNzLCB3aGljaCB3aWxsIGJlIHVzZWQuIFBvc3NpYmxlIHZhbHVlcyBhcmU6DQogICAgICogICAgICAgICAvLyAtIFZpZXcgLSB3aXRob3V0IGFueSBhbmltYXRpb24gKGJhc2UgY2xhc3MpLA0KICAgICAqICAgICAgICAgLy8gLSBQcm9ncmVzc0JhclZpZXcgLSBzaG93cyB0aGUgcHJvZ3Jlc3Mgb2YgdGltZSBhcyBwcm9ncmVzcyBiYXIsDQogICAgICogICAgICAgICAvLyAtIFJvdGF0b3JWaWV3IC0gc2hvd3MgdGhlIHByb2dyZXNzIG9mIHRpbWUgd2l0aCB0aGUgZmlsbGluZyB1cCByaW5nDQogICAgICogICAgICAgICAvLyAtIG90aGVyIC0gaWYgaW1wbGVtZW50ZWQgKGRlcml2ZWQgZnJvbSBYQS5jb21wb25lbnQuY2Fyb3VzZWxzLkluZGljYXRvclZpZXdzLlZpZXcgY2xhc3MpIGFuZCBhZGRlZCB0byBYQS5jb21wb25lbnQuY2Fyb3VzZWxzLkluZGljYXRvclZpZXdzIG1vZHVsZS4NCiAgICAgKiAgICAgICAgIC8vDQogICAgICogICAgICAgICAndmlldyc6ICdWaWV3JywNCiAgICAgKiAgICAgICAgIC8vDQogICAgICogICAgICAgICAvLyBvcHRpb25zOiBPYmplY3QNCiAgICAgKiAgICAgICAgIC8vDQogICAgICogICAgICAgICAvLyAnVGltZSBpbmRpY2F0b3InIHZpZXcgc2V0dGluZ3Mgb2JqZWN0LiBEZXBlbmRzIG9uIHZpZXcuDQogICAgICogICAgICAgICAvLw0KICAgICAqICAgICAgICAgJ29wdGlvbnMnOiB7fQ0KICAgICAqICAgICB9DQogICAgICogfQ0KICAgICAqLw0KDQogICAgLyogcHViLnJlZ2lzdGVyID0gZnVuY3Rpb24gKHNlbGVjdG9yLCBvcHRpb25zKSB7DQogICAgIHZhciAkY2Fyb3VzZWxzID0gJChzZWxlY3Rvcik7DQogICAgICRjYXJvdXNlbHMuZWFjaChmdW5jdGlvbiAoKSB7DQogICAgIC8vdmFyIGNhcm91c2VsID0gbmV3IENhcm91c2VsKCQpOw0KICAgICBjb25zb2xlLmxvZygkKHRoaXMpKTsNCiAgICAgLy9jYXJvdXNlbC5pbml0KCQodGhpcyksIG9wdGlvbnMpOw0KICAgICB9KTsNCiAgICAgfTsqLw0KDQogICAgLyogQ2Fyb3VzZWwgdG91Y2ggc3VwcG9ydCAqLw0KICAgIENhcm91c2VsLnByb3RvdHlwZS5zd2lwZVNsaWRlID0gZnVuY3Rpb24oKSB7DQogICAgICAgIHZhciBzZWxmID0gdGhpcywNCiAgICAgICAgICAgICR3cmFwcGVyID0gdGhpcy5zbGlkZXIuY29udGV4dC4kd3JhcHBlciwNCiAgICAgICAgICAgIGhhbW1lciA9IG5ldyBIYW1tZXIoJHdyYXBwZXJbMF0pOw0KICAgICAgICAgICAgaGFtbWVyLmdldCgncGFuJykuc2V0KHsgZGlyZWN0aW9uOiBIYW1tZXIuRElSRUNUSU9OX0FMTCB9KTsNCg0KICAgICAgICBoYW1tZXIub24oInN3aXBlbGVmdCIsIGZ1bmN0aW9uKGUpIHsNCiAgICAgICAgICAgIHNlbGYuc2xpZGVyLmNvbnRleHQub3duZXIub25DaGFuZ2VDdXJyZW50U2xpZGUoZSwgMSwgc2VsZi5zbGlkZXIuY29udGV4dCk7DQogICAgICAgIH0pOw0KDQogICAgICAgIGhhbW1lci5vbigic3dpcGVyaWdodCIsIGZ1bmN0aW9uKGUpIHsNCiAgICAgICAgICAgIHNlbGYuc2xpZGVyLmNvbnRleHQub3duZXIub25DaGFuZ2VDdXJyZW50U2xpZGUoZSwgLTEsIHNlbGYuc2xpZGVyLmNvbnRleHQpOw0KICAgICAgICB9KTsNCiAgICB9Ow0KDQogICAgQ2Fyb3VzZWwucHJvdG90eXBlLmRpc2FibGVFbXB0eVNsaWRlcyA9IGZ1bmN0aW9uKCkgew0KICAgICAgICB2YXIgZW1wdHlQbGFjZWhvbGRlcnMgPSB0aGlzLiRzbGlkZXMuZmluZCgiLnNjRW1wdHlQbGFjZWhvbGRlciIpLA0KICAgICAgICAgICAgcGxhY2Vob2xkZXJDb2RlVGFnLA0KICAgICAgICAgICAgJHBsYWNlaG9sZGVyLA0KICAgICAgICAgICAgcGxhY2Vob2xkZXJJZCwNCiAgICAgICAgICAgIHBsYWNlaG9sZGVyS2V5LA0KICAgICAgICAgICAgZWRpdEZyYW1lLA0KICAgICAgICAgICAgY2hyb21lS2V5LA0KICAgICAgICAgICAgaDsNCg0KICAgICAgICBfLmVhY2goZW1wdHlQbGFjZWhvbGRlcnMsIGZ1bmN0aW9uKHBsYWNlaG9sZGVyKSB7DQogICAgICAgICAgICAkcGxhY2Vob2xkZXIgPSAkKHBsYWNlaG9sZGVyKTsNCiAgICAgICAgICAgIHBsYWNlaG9sZGVySWQgPSAkcGxhY2Vob2xkZXIuYXR0cigic2MtcGxhY2Vob2xkZXItaWQiKTsNCg0KICAgICAgICAgICAgLy9kaXNhYmxlIGVkaXQgZnJhbWVzDQogICAgICAgICAgICBwbGFjZWhvbGRlckNvZGVUYWcgPSAkcGxhY2Vob2xkZXIuc2libGluZ3MoImNvZGVbY2hyb21ldHlwZT0ncGxhY2Vob2xkZXInXVtpZD0nIiArIHBsYWNlaG9sZGVySWQgKyAiJ10iKTsNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgcGxhY2Vob2xkZXJLZXkgPSBwbGFjZWhvbGRlckNvZGVUYWcuYXR0cigia2V5Iik7DQogICAgICAgICAgICAgICAgaWYgKHR5cGVvZihwbGFjZWhvbGRlcktleSkgPT09ICJzdHJpbmciKSB7DQogICAgICAgICAgICAgICAgICAgIGVkaXRGcmFtZSA9IFNpdGVjb3JlLlBhZ2VNb2Rlcy5DaHJvbWVNYW5hZ2VyLmNocm9tZXMoKS5maWx0ZXIoZnVuY3Rpb24oY2hyb21lKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBjaHJvbWVLZXkgPSBjaHJvbWUub3BlbmluZ01hcmtlcigpOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFjaHJvbWVLZXkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIGNocm9tZUtleSA9IGNocm9tZUtleS5hdHRyKCJrZXkiKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0eXBlb2YoY2hyb21lS2V5KSAhPT0gInVuZGVmaW5lZCIgJiYgY2hyb21lS2V5LmluZGV4T2YocGxhY2Vob2xkZXJLZXkpID09PSAwOw0KICAgICAgICAgICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgICAgICAgICBlZGl0RnJhbWVbMF0udHlwZS5jaHJvbWUuZGF0YS5jdXN0b20uZWRpdGFibGUgPSAiZmFsc2UiOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIHRocm93IDY2NjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9IGNhdGNoIChlKSB7IC8vZmFsbGJhY2sgLSBkZWxldGUgY29kZSB0YWdzIHRvIHByZXZlbnQgaW5zZXJ0aW5nIGludG8gcGxhY2Vob2xkZXJzDQogICAgICAgICAgICAgICAgJHBsYWNlaG9sZGVyLnNpYmxpbmdzKCJjb2RlW2Nocm9tZXR5cGU9J3BsYWNlaG9sZGVyJ10iKS5yZW1vdmUoKTsNCiAgICAgICAgICAgICAgICAvKiBlc2xpbnQtZGlzYWJsZSBuby1jb25zb2xlICovDQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coIkNvdWxkIG5vdCBkaXNhYmxlIGVkaXRpbmcgZm9yIHBsYWNlaG9sZGVyIiwgZSk7DQogICAgICAgICAgICAgICAgLyogZXNsaW50LWVuYWJsZSBuby1jb25zb2xlICovDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vYWRqdXN0IGhlaWdodCwgYW5kIHJlbW92ZSBwbGFjZWhvbGRlciAiZGFzaGVkIiBiYWNrZ3JvdW5kDQogICAgICAgICAgICBoID0gJHBsYWNlaG9sZGVyLmhlaWdodCgpICsgInB4IjsNCiAgICAgICAgICAgICRwbGFjZWhvbGRlci5yZW1vdmVDbGFzcygic2NFbXB0eVBsYWNlaG9sZGVyIik7DQogICAgICAgICAgICAkcGxhY2Vob2xkZXIuY3NzKCJoZWlnaHQiLCBoKTsNCg0KICAgICAgICAgICAgLy9zZXQgZWRpdCBoZXJlIHRleHQNCiAgICAgICAgICAgICRwbGFjZWhvbGRlci5hcHBlbmQoJCgiPHA+W05vIGNvbXBvbmVudHMgaW4gc2xpZGVdPC9wPiIpKTsNCiAgICAgICAgfSk7DQogICAgfQ0KDQoNCiAgICBDYXJvdXNlbC5wcm90b3R5cGUucmVzaXplV3JhcHBlciA9IGZ1bmN0aW9uKCkgew0KICAgICAgICB2YXIgcGFnZUhlaWdodCA9ICQoZG9jdW1lbnQpLm91dGVySGVpZ2h0KCksDQogICAgICAgICAgICBoZWFkZXJIZWlnaHQgPSAkKCcjaGVhZGVyJykub3V0ZXJIZWlnaHQoKSwNCiAgICAgICAgICAgIGNvbnRlbnRQYWRkaW5nVG9wID0gcGFyc2VJbnQoJCgnI2NvbnRlbnQnKS5jc3MoJ3BhZGRpbmctdG9wJyksIDEwKSwNCiAgICAgICAgICAgIGNvbnRlbnRQYWRkaW5nQm90dG9tID0gcGFyc2VJbnQoJCgnI2NvbnRlbnQnKS5jc3MoJ3BhZGRpbmctYm90dG9tJyksIDEwKSwNCiAgICAgICAgICAgIGNvbnRlbnRQYWRkaW5nID0gY29udGVudFBhZGRpbmdUb3AgKyBjb250ZW50UGFkZGluZ0JvdHRvbSwNCiAgICAgICAgICAgIGZvb3RlckhlaWdodCA9ICQoJyNmb290ZXInKS5vdXRlckhlaWdodCgpLA0KICAgICAgICAgICAgd3JhcHBlciA9IHRoaXMuc2xpZGVyLmNvbnRleHQuJHdyYXBwZXIsDQogICAgICAgICAgICBjYXJvdXNlbEhlaWdodCA9IDA7DQoNCiAgICAgICAgY2Fyb3VzZWxIZWlnaHQgPSBwYWdlSGVpZ2h0IC0gKGhlYWRlckhlaWdodCArIGZvb3RlckhlaWdodCArIGNvbnRlbnRQYWRkaW5nKTsNCg0KICAgICAgICB3cmFwcGVyLmNzcyh7DQogICAgICAgICAgICAnaGVpZ2h0JzogY2Fyb3VzZWxIZWlnaHQNCiAgICAgICAgfSk7DQoNCiAgICAgICAgd3JhcHBlci5maW5kKCcuc2xpZGVzJykuY3NzKHsNCiAgICAgICAgICAgICdoZWlnaHQnOiBjYXJvdXNlbEhlaWdodA0KICAgICAgICB9KTsNCiAgICB9Ow0KDQogICAgZnVuY3Rpb24gZ2V0UXVlcnlQYXJhbSh2YXJpYWJsZSkgew0KICAgICAgICB2YXIgcXVlcnkgPSB3aW5kb3cubG9jYXRpb24uc2VhcmNoLnN1YnN0cmluZygxKTsNCiAgICAgICAgdmFyIHZhcnMgPSBxdWVyeS5zcGxpdCgiJiIpOw0KICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZhcnMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgIHZhciBwYWlyID0gdmFyc1tpXS5zcGxpdCgiPSIpOw0KICAgICAgICAgICAgaWYgKGRlY29kZVVSSUNvbXBvbmVudChwYWlyWzBdKSA9PT0gdmFyaWFibGUpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KHBhaXJbMV0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiBudWxsOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHVwZGF0ZVF1ZXJ5UGFyYW0oa2V5LCB2YWx1ZSkgew0KICAgICAgICB2YXIgdXJsOw0KICAgICAgICANCiAgICAgICAgaWYgKHdpbmRvdy5sb2NhdGlvbi5ocmVmLmluZGV4T2Yoa2V5ICsgIj0iKSA+IC0xKSB7DQogICAgICAgICAgICB1cmwgPSBsb2NhdGlvbi5ocmVmLnJlcGxhY2Uoa2V5ICsgIj0iICsgZ2V0UXVlcnlQYXJhbShrZXkpLCBrZXkgKyAiPSIgKyB2YWx1ZSk7DQogICAgICAgIH0gZWxzZSBpZiAod2luZG93LmxvY2F0aW9uLmhyZWYuaW5kZXhPZigiPyIpID4gLTEpIHsNCiAgICAgICAgICAgIHVybCA9IGxvY2F0aW9uLmhyZWYgKyAiJiIgKyBrZXkgKyAiPSIgKyB2YWx1ZTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHVybCA9IGxvY2F0aW9uLmhyZWYgKyAiPyIgKyBrZXkgKyAiPSIgKyB2YWx1ZTsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChoaXN0b3J5LnB1c2hTdGF0ZSkgew0KICAgICAgICAgICAgd2luZG93Lmhpc3RvcnkucmVwbGFjZVN0YXRlKHtwYXRoOnVybH0sICIiLCB1cmwpOw0KICAgICAgICB9DQogICAgfQ0KDQoNCiAgICBwdWIuaW5pdCA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgJCgiLmNhcm91c2VsOm5vdCguaW5pdGlhbGl6ZWQpIikuZWFjaChmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICB2YXIgcHJvcGVydGllcyA9ICQodGhpcykuZGF0YSgicHJvcGVydGllcyIpLA0KICAgICAgICAgICAgICAgIGNvbXBvbmVudCA9ICQodGhpcykuZmluZCgiLmNhcm91c2VsLWlubmVyIiksDQogICAgICAgICAgICAgICAgaWQgPSBjb21wb25lbnQuYXR0cigiZGF0YS1pZCIpLA0KICAgICAgICAgICAgICAgIHNlbGYgPSB0aGlzLA0KICAgICAgICAgICAgICAgIHF1ZXJ5U2xpZGVJbmRleCA9IE51bWJlci5wYXJzZUludChnZXRRdWVyeVBhcmFtKGNvbXBvbmVudC5jbG9zZXN0KCcuY29tcG9uZW50LmNhcm91c2VsJykuYXR0cigiaWQiKSB8fCAiY2Fyb3VzZWwiKSksDQogICAgICAgICAgICAgICAgdmFsaWRRdWVyeVBhcmFtID0gdHlwZW9mIHF1ZXJ5U2xpZGVJbmRleCAhPT0gInVuZGVmaW5lZCIgJiYgIU51bWJlci5pc05hTihxdWVyeVNsaWRlSW5kZXgpICYmIHF1ZXJ5U2xpZGVJbmRleCA8IGNvbXBvbmVudC5maW5kKCIuc3hhLW51bWJlcnMiKS5sZW5ndGgsDQogICAgICAgICAgICAgICAgY29udGV4dCwgc2V0dGluZ3MsICRjdXJyZW50U2xpZGUsICRzbGlkZXM7DQoNCiAgICAgICAgICAgIGlmIChwcm9wZXJ0aWVzKSB7DQogICAgICAgICAgICAgICAgaWYgKCFwcm9wZXJ0aWVzLm5hdmlnYXRpb24pIHsNCiAgICAgICAgICAgICAgICAgICAgcHJvcGVydGllcy5uYXZpZ2F0aW9uID0gew0KICAgICAgICAgICAgICAgICAgICAgICAgaXRlbToge30sDQogICAgICAgICAgICAgICAgICAgICAgICBwcmV2SXRlbToge30sDQogICAgICAgICAgICAgICAgICAgICAgICBuZXh0SXRlbToge30sDQogICAgICAgICAgICAgICAgICAgICAgICBpc0VuYWJsZWQ6IHZhbGlkUXVlcnlQYXJhbSA/IGZhbHNlOiB0cnVlDQogICAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHByb3BlcnRpZXMubmF2aWdhdGlvbi5pdGVtLnNlbGVjdG9yID0gIltkYXRhLWlkPSciICsgaWQgKyAiJ10gLm5hdi1pdGVtcyI7IC8vcHJvcGVydGllcy5uYXZpZ2F0aW9uLml0ZW0uc2VsZWN0b3I7DQogICAgICAgICAgICAgICAgcHJvcGVydGllcy5uYXZpZ2F0aW9uLnByZXZJdGVtLnNlbGVjdG9yID0gIiMiICsgaWQgKyAiIC5uYXYiOw0KICAgICAgICAgICAgICAgIHByb3BlcnRpZXMubmF2aWdhdGlvbi5uZXh0SXRlbS5zZWxlY3RvciA9ICIjIiArIGlkICsgIiAubmF2IjsNCg0KICAgICAgICAgICAgICAgIHZhciBjYXJvdXNlbCA9IG5ldyBDYXJvdXNlbCgkKTsNCiAgICAgICAgICAgICAgICBjYXJvdXNlbC5pbml0KGNvbXBvbmVudCwgcHJvcGVydGllcyk7DQoNCiAgICAgICAgICAgICAgICAkKHdpbmRvdykub24oJ2xvYWQnLCBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCQoc2VsZikuaGFzQ2xhc3MoJ2Nhcm91c2VsLWNsaWVudHMnKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgY2Fyb3VzZWwucmVzaXplV3JhcHBlcigpOw0KICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgICAgY2Fyb3VzZWwuZGlzYWJsZUVtcHR5U2xpZGVzKCk7DQogICAgICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgICAgICBpZiAodmFsaWRRdWVyeVBhcmFtKSB7DQogICAgICAgICAgICAgICAgICAgIGNvbnRleHQgPSBjYXJvdXNlbC5zbGlkZXIuY29udGV4dCwNCiAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3MgPSBjb250ZXh0LnRyYW5zaXRpb25TZXR0aW5ncywNCiAgICAgICAgICAgICAgICAgICAgJGN1cnJlbnRTbGlkZSA9IGNvbnRleHQuZ2V0Q3VycmVudFNsaWRlKCksDQogICAgICAgICAgICAgICAgICAgICRzbGlkZXMgPSBjb250ZXh0LiRzbGlkZXM7DQoNCiAgICAgICAgICAgICAgICAgICAgY29udGV4dC5jYW5DaGFuZ2VTbGlkZSA9IGZhbHNlOw0KICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncy4kY3VycmVudFNsaWRlID0gJGN1cnJlbnRTbGlkZTsNCiAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3MuJG5leHRTbGlkZSA9ICQoJHNsaWRlc1txdWVyeVNsaWRlSW5kZXhdKTsNCg0KICAgICAgICAgICAgICAgICAgICBjb250ZXh0LmNoYW5nZUN1cnJlbnRTbGlkZShzZXR0aW5ncy4kbmV4dFNsaWRlKTsNCiAgICAgICAgICAgICAgICAgICAgY29udGV4dC50cmFuc2l0aW9uLnBlcmZvcm0oY29udGV4dC50cmFuc2l0aW9uU2V0dGluZ3MpOw0KICAgICAgICAgICAgICAgICAgICBjb250ZXh0Lm93bmVyLmV4ZWN1dGVPblRpbWVycygncmVzZXQnLCBjb250ZXh0KTsNCg0KICAgICAgICAgICAgICAgICAgICBjb250ZXh0Lm5hdmlnYXRpb24ucHJlcGFyZUl0ZW1zKHByb3BlcnRpZXMubmF2aWdhdGlvbi5pdGVtLCAkc2xpZGVzLmxlbmd0aCwgJChjb250ZXh0LiR3cmFwcGVyKSk7DQogICAgICAgICAgICAgICAgICAgIGNvbnRleHQubmF2aWdhdGlvbi5zZWxlY3RJdGVtKHF1ZXJ5U2xpZGVJbmRleCk7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgY2Fyb3VzZWwuc3dpcGVTbGlkZSgpOyAgIA0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgJCh0aGlzKS5hZGRDbGFzcygiaW5pdGlhbGl6ZWQiKTsNCiAgICAgICAgfSk7DQogICAgfTsNCg0KICAgIHJldHVybiBwdWI7DQp9KGpRdWVyeSkpOw0KLyoqDQogKiBlbmQgb2YgWEEuY29tcG9uZW50LmNhcm91c2VscyBtb2R1bGUuDQogKi8NCg0KDQpYQS5yZWdpc3RlcigiY2Fyb3VzZWxzIiwgWEEuY29tcG9uZW50LmNhcm91c2Vscyk7DQoNCg0KLyoqDQogKiBYQUNvbnRleHQNCiAqDQogKiBYQS5jb21wb25lbnQuY2Fyb3VzZWxzLlRyYW5zaXRpb25zIG1vZHVsZS4NCiAqDQogKiBFeHBvc2VzIFRyYW5zaXRpb24gY2xhc3MsIHdoaWNoIGlzIGJhc2UgY2xhc3Mgb2YgYWxsIHRyYW5zaXRpb25zIHVzZWQgYnkgY2Fyb3VzZWxzIChAc2VlIFhBLmNvbXBvbmVudC5jYXJvdXNlbHMsIEBzZWUgU2xpZGVyLCBAc2VlIFRyYW5zaXRpb24pLg0KICogQWxzbyBleHBvc2VzIGltcGxlbWVudGF0aW9uIG9mIGJhc2ljIGVmZmVjdHM6DQogKiAtIEJhc2ljVHJhbnNpdGlvbiAtIHdpdGhvdXQgYW55IGFuaW1hdGlvbiwNCiAqIC0gRmFkZUluVHJhbnNpdGlvbiAtIG5ldyBzbGlkZSBmYWRlcyBpbiwNCiAqIC0gU2xpZGVIb3Jpem9udGFsbHlUcmFuc2l0aW9uIC0gbmV3IHNsaWRlIG1vdmVzIGZyb20gcmlnaHQgKGZyb20gbGVmdCBpZiB1c2VyIHNlbGVjdHMgc2xpZGUgd2l0aCBsb3dlciBpZCBvciBjbGlja3Mgb24gJ3ByZXZpb3VzIGl0ZW0nKSwNCiAqIC0gU2xpZGVWZXJ0aWNhbGx5VHJhbnNpdGlvbiAtIG5ldyBzbGlkZSBtb3ZlcyBmcm9tIHRvcCAoZnJvbSBib3R0b20gaWYgdXNlciBzZWxlY3RzIHNsaWRlIHdpdGggbG93ZXIgaWQgb3IgY2xpY2tzIG9uICdwcmV2aW91cyBpdGVtJykuDQogKiBDYXJvdXNlbCB0YWtlcyB0aGUgY2xhc3MgY29uc3RydWN0b3IgYnkgbmFtZSBmcm9tIHRoaXMgbW9kdWxlIChpdCBpcyBnaXZlbiBpbiBvcHRpb25zIG9iamVjdCBvZiBjYXJvdXNlbDsgQHNlZSBYQS5jb21wb25lbnQuY2Fyb3VzZWxzKS4NCiAqIElmIHRoZXJlIGlzIGEgbmVlZCB0byBpbXBsZW1lbnQgdGhlIG5ldyBlZmZlY3QsIGNyZWF0ZSBhIG5ldyBjbGFzcywgYnkgaW5oZXJpdGluZyBmcm9tIFRyYW5zaXRpb24gY2xhc3MgYW5kIGFkZCBpdCB0byB0aGlzIG1vZHVsZS4NCiAqDQogKiBFeGFtcGxlIGVmZmVjdCBpbXBsZW1lbnRhdGlvbiAoY3VycmVudGx5IGRpc3BsYXllZCBzbGlkZSBpcyBzaHJpbmtpbmcgdG8gY2VudGVyIG9mIHRoZSBjYXJvdXNlbCk6DQogKiAoZnVuY3Rpb24gKCkgew0KKiAgICAgZnVuY3Rpb24gU2FtcGxlVHJhbnNpdGlvbigpIHsgfQ0KKg0KKiAgICAgLy9pbmhlcml0IGZyb20gWEEuY29tcG9uZW50LmNhcm91c2Vscy5UcmFuc2l0aW9ucy5UcmFuc2l0aW9uDQoqICAgICBTYW1wbGVUcmFuc2l0aW9uLnByb3RvdHlwZSA9IG5ldyBYQS5jb21wb25lbnQuY2Fyb3VzZWxzLlRyYW5zaXRpb25zLlRyYW5zaXRpb24oKTsNCiogICAgIFNhbXBsZVRyYW5zaXRpb24uY29uc3RydWN0b3IgPSBTYW1wbGVUcmFuc2l0aW9uOw0KKg0KKiAgICAgU2FtcGxlVHJhbnNpdGlvbi5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uIChzZXR0aW5ncykgew0KKiAgICAgICAgIC8vcG9zaXRpb25pbmcgYWxsIHNsaWRlcyBpbiB0aGUgdG9wIGxlZnQgY29ybmVyIG9mIHRoZSBjYXJvdXNlbA0KKiAgICAgICAgIHNldHRpbmdzLiRzbGlkZXMuY3NzKHsNCiogICAgICAgICAgICAgJ3Bvc2l0aW9uJzogJ2Fic29sdXRlJywNCiogICAgICAgICAgICAgJ3RvcCc6ICcwcHgnLA0KKiAgICAgICAgICAgICAnbGVmdCc6ICcwcHgnDQoqICAgICAgICAgfSk7DQoqICAgICB9Ow0KKg0KKiAgICAgU2FtcGxlVHJhbnNpdGlvbi5wcm90b3R5cGUub25BbmltYXRpb25Db21wbGV0ZSA9IGZ1bmN0aW9uKHNldHRpbmdzLCB3aWR0aCwgaGVpZ2h0KSB7DQoqICAgICAgICAgdmFyIHpJbmRleEF0dHJpYiA9ICd6LWluZGV4JywNCiogICAgICAgICAkY3VycmVudCA9IHNldHRpbmdzLiRjdXJyZW50U2xpZGU7DQoqDQoqICAgICAgICAgJGN1cnJlbnQuaGlkZSgpOw0KICAgICAgICAgIC8vcmV2ZXJ0aW5nIGNoYW5nZXMgaW4gY3NzIHByb3BlcnRpZXMNCiogICAgICAgICAkY3VycmVudC5jc3Moew0KKiAgICAgICAgICAgICAnd2lkdGgnOiB3aWR0aCwNCiogICAgICAgICAgICAgJ2hlaWdodCc6IGhlaWdodCwNCiogICAgICAgICAgICAgJ2xlZnQnOiAwLA0KKiAgICAgICAgICAgICAndG9wJzogMA0KKiAgICAgICAgIH0pOw0KKiAgICAgICAgICRjdXJyZW50LmNzcyh6SW5kZXhBdHRyaWIsICcnKTsNCiogICAgICAgICBzZXR0aW5ncy4kc2xpZGVzLnBhcmVudCgpLmNzcyh6SW5kZXhBdHRyaWIsICcnKTsNCioNCiogICAgICAgICAvL25vdGlmeWluZyB0aGUgY2Fyb3VzZWwsIHRoYXQgYW5pbWF0aW9uIGlzIGNvbXBsZXRlZA0KKiAgICAgICAgIHNldHRpbmdzLmNhbGxiYWNrKCk7DQoqICAgICB9Ow0KKg0KKiAgICAgU2FtcGxlVHJhbnNpdGlvbi5wcm90b3R5cGUucGVyZm9ybSA9IGZ1bmN0aW9uIChzZXR0aW5ncykgew0KKiAgICAgICAgIHZhciBoZWlnaHQgPSBzZXR0aW5ncy4kY3VycmVudFNsaWRlLmhlaWdodCgpLA0KKiAgICAgICAgIHdpZHRoID0gc2V0dGluZ3MuJGN1cnJlbnRTbGlkZS53aWR0aCgpLA0KKiAgICAgICAgIG9uQW5pbWF0aW9uQ29tcGxldGVkID0gdGhpcy5vbkFuaW1hdGlvbkNvbXBsZXRlLA0KKiAgICAgICAgIHpJbmRleEF0dHJpYiA9ICd6LWluZGV4JywNCiogICAgICAgICAkcGFyZW50ID0gc2V0dGluZ3MuJHNsaWRlcy5wYXJlbnQoKSwNCiogICAgICAgICAkY3VycmVudCA9IHNldHRpbmdzLiRjdXJyZW50U2xpZGUsDQoqICAgICAgICAgJG5leHQgPSBzZXR0aW5ncy4kbmV4dFNsaWRlOw0KKg0KKiAgICAgICAgIC8vc2V0dGluZyBhIG5ldyBzbGlkZSB1bmRlciB0aGUgY3VycmVudCBzbGlkZQ0KKiAgICAgICAgICRwYXJlbnQuY3NzKHpJbmRleEF0dHJpYiwgMCk7DQoqICAgICAgICAgJGN1cnJlbnQuY3NzKHpJbmRleEF0dHJpYiwgMSk7DQoqICAgICAgICAgJG5leHQuc2hvdygpOw0KKg0KKiAgICAgICAgIC8vYW5pbWF0ZSBjdXJyZW50IHNsaWRlDQoqICAgICAgICAgJGN1cnJlbnQuYW5pbWF0ZSh7DQoqICAgICAgICAgICAgICd3aWR0aCc6ICcwcHgnLA0KKiAgICAgICAgICAgICAnaGVpZ2h0JzogJzBweCcsDQoqICAgICAgICAgICAgICdsZWZ0Jzogd2lkdGggLyAyLA0KKiAgICAgICAgICAgICAndG9wJzogaGVpZ2h0IC8gMg0KKiAgICAgICAgIH0sIGZ1bmN0aW9uKCkgew0KKiAgICAgICAgICAgICBvbkFuaW1hdGlvbkNvbXBsZXRlZChzZXR0aW5ncywgd2lkdGgsIGhlaWdodCk7DQoqICAgICAgICAgfSk7DQoqICAgICB9Ow0KKg0KKiAgICAgLy9hZGRpbmcgbmV3IGVmZmVjdCB0byBYQS5jb21wb25lbnQuY2Fyb3VzZWxzLlRyYW5zaXRpb25zIG1vZHVsZS4NCiogICAgIFhBLmNvbXBvbmVudC5jYXJvdXNlbHMuVHJhbnNpdGlvbnMuU2FtcGxlVHJhbnNpdGlvbiA9IFNhbXBsZVRyYW5zaXRpb247DQoqIH0gKCkpOw0KICoNCiAqLw0KWEEuY29tcG9uZW50LmNhcm91c2Vscy5UcmFuc2l0aW9ucyA9IChmdW5jdGlvbigpIHsNCiAgICB2YXIgcHViID0ge307DQoNCiAgICAvKioNCiAgICAgKiBUcmFuc2l0aW9uU2V0dGluZ3MgY2xhc3MgaG9sZHMgZGF0YSBuZWVkZWQgZm9yIGNoYW5naW5nIHNsaWRlcw0KICAgICAqIEBjb25zdHJ1Y3Rvcg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIFRyYW5zaXRpb25TZXR0aW5ncygpIHt9DQogICAgLyoqDQogICAgICogQ3VycmVudCBzbGlkZSAoY3VycmVudGx5IGRpc3BsYXllZCkgalF1ZXJ5IG9iamVjdA0KICAgICAqDQogICAgICogQG1lbWJlciBUcmFuc2l0aW9uU2V0dGluZ3MNCiAgICAgKi8NCiAgICBUcmFuc2l0aW9uU2V0dGluZ3MucHJvdG90eXBlLiRjdXJyZW50U2xpZGUgPSBudWxsOw0KICAgIC8qKg0KICAgICAqIE5leHQgc2xpZGUgalF1ZXJ5IG9iamVjdA0KICAgICAqDQogICAgICogQG1lbWJlciBUcmFuc2l0aW9uU2V0dGluZ3MNCiAgICAgKi8NCiAgICBUcmFuc2l0aW9uU2V0dGluZ3MucHJvdG90eXBlLiRuZXh0U2xpZGUgPSBudWxsOw0KICAgIC8qKg0KICAgICAqIEFsbCBzbGlkZXMgKGpRdWVyeSBvYmplY3QpDQogICAgICoNCiAgICAgKiBAbWVtYmVyIFRyYW5zaXRpb25TZXR0aW5ncw0KICAgICAqLw0KICAgIFRyYW5zaXRpb25TZXR0aW5ncy5wcm90b3R5cGUuJHNsaWRlcyA9IG51bGw7DQogICAgLyoqDQogICAgICogT2Zmc2V0IGJldHdlZW4gJGN1cnJlbnRTbGlkZSBhbmQgJG5leHRTbGlkZQ0KICAgICAqDQogICAgICogQG1lbWJlciBUcmFuc2l0aW9uU2V0dGluZ3MNCiAgICAgKi8NCiAgICBUcmFuc2l0aW9uU2V0dGluZ3MucHJvdG90eXBlLm9mZnNldCA9IDA7DQogICAgLyoqDQogICAgICogQ2FsbGJhY2sgZnVuY3Rpb24gd2hpY2ggbXVzdCBiZSBjYWxsZWQgYWZ0ZXIgYW5pbWF0aW9uLg0KICAgICAqDQogICAgICogQG1lbWJlciBUcmFuc2l0aW9uU2V0dGluZ3MNCiAgICAgKi8NCiAgICBUcmFuc2l0aW9uU2V0dGluZ3MucHJvdG90eXBlLmNhbGxiYWNrID0gbnVsbDsNCiAgICAvKioNCiAgICAgKiBlbmQgb2YgVHJhbnNpdGlvblNldHRpbmdzIGNsYXNzDQogICAgICovDQogICAgcHViLlRyYW5zaXRpb25TZXR0aW5ncyA9IFRyYW5zaXRpb25TZXR0aW5nczsNCg0KICAgIC8qKg0KICAgICAqIFRyYW5zaXRpb24gY2xhc3MgaXMgYSBiYXNlIGNsYXNzIG9mIGFsbCB0cmFuc2l0aW9ucy4NCiAgICAgKg0KICAgICAqIEltcG9ydGFudDogc2V0dGluZ3MuY2FsbGJhY2soKSAoQHNlZSBUcmFuc2l0aW9uU2V0dGluZ3MpIGhhdmUgdG8gYmUgY2FsbGVkIGF0IHRoZSBlbmQgb2YgZXhlY3V0aW9uIHRoZSBwZXJmb3JtKCkgbWV0aG9kLg0KICAgICAqDQogICAgICogQGNvbnN0cnVjdG9yDQogICAgICovDQogICAgZnVuY3Rpb24gVHJhbnNpdGlvbigpIHt9DQogICAgVHJhbnNpdGlvbi5wcm90b3R5cGUgPSBuZXcgVHJhbnNpdGlvbigpOw0KICAgIC8qKg0KICAgICAqIEluaXRpYWxpemVzIGEgdHJhbnNpdGlvbiB3aXRoIGdpdmVuIHNldHRpbmdzIChAc2VlIFRyYW5zaXRpb25TZXR0aW5ncykuDQogICAgICogDQogICAgICogQG1lbWJlciBUcmFuc2l0aW9uDQogICAgICogQHBhcmFtIHtUcmFuc2l0aW9uU2V0dGluZ3N9IHNldHRpbmdzICB0cmFuc2l0aW9uIHNldHRpbmdzDQogICAgICovDQogICAgLyogZXNsaW50LWRpc2FibGUgKi8NCiAgICBUcmFuc2l0aW9uLnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24oc2V0dGluZ3MpIHsNCiAgICAgICAgLy9pbXBsZW1lbnRhdGlvbiB1c2luZyBzZXR0aW5ncw0KICAgIH07DQogICAgLyogZXNsaW50LWVuYWJsZSAqLw0KICAgIC8qKg0KICAgICAqIFJldHVybnMgYSBmYWN0b3IgYXNzb2NpYXRlZCB3aXRoIHNldHRpbmdzLm9mZnNldCAoQHNlZSBUcmFuc2l0aW9uU2V0dGluZ3MpLCB3aGljaA0KICAgICAqIGNhbiBiZSB1c2VmdWxsIGZvciBzb21lIGFuaW1hdGlvbnMuDQogICAgICoNCiAgICAgKiBAbWVtYmVyIFRyYW5zaXRpb24NCiAgICAgKiBAcGFyYW0ge1RyYW5zaXRpb25TZXR0aW5nc30gc2V0dGluZ3MgIHRyYW5zaXRpb24gc2V0dGluZ3MNCiAgICAgKiBAcmV0dXJuIFRoZSBmYWN0b3I7IDEgaWYgb2Zmc2V0IGlzIGhpZ2hlciB0aGFuIDAsIC0xIG90aGVyd2lzZQ0KICAgICAqIEB0eXBlIE51bWJlcg0KICAgICAqLw0KICAgIFRyYW5zaXRpb24ucHJvdG90eXBlLmZhY3RvciA9IGZ1bmN0aW9uKHNldHRpbmdzKSB7DQogICAgICAgIHJldHVybiAoc2V0dGluZ3Mub2Zmc2V0ID4gMCkgPyAxIDogLTE7DQogICAgfTsNCiAgICAvKioNCiAgICAgKiBUaGlzIG1ldGhvZCBpcyBjYWxsZWQgdXNlZCBieSBjYXJvdXNlbHMgdG8gY2hhbmdlIHNsaWRlcy4NCiAgICAgKg0KICAgICAqIEltcG9ydGFudDogc2V0dGluZ3MuY2FsbGJhY2soKSAoQHNlZSBUcmFuc2l0aW9uU2V0dGluZ3MpIGhhdmUgdG8gYmUgY2FsbGVkIGF0IHRoZSBlbmQgb2YgdGhpcyBtZXRob2QgZXhlY3V0aW9uLg0KICAgICAqDQogICAgICogQG1lbWJlciBUcmFuc2l0aW9uDQogICAgICogQHBhcmFtIHtUcmFuc2l0aW9uU2V0dGluZ3N9IHNldHRpbmdzICB0cmFuc2l0aW9uIHNldHRpbmdzDQogICAgICovDQogICAgVHJhbnNpdGlvbi5wcm90b3R5cGUucGVyZm9ybSA9IGZ1bmN0aW9uKHNldHRpbmdzKSB7DQogICAgICAgIHNldHRpbmdzLmNhbGxiYWNrKCk7DQogICAgfTsNCiAgICAvKioNCiAgICAgKiBFbmQgb2YgVHJhbnNpdGlvbiBjbGFzcw0KICAgICAqLw0KICAgIHB1Yi5UcmFuc2l0aW9uID0gVHJhbnNpdGlvbjsNCg0KICAgIC8qKg0KICAgICAqIEJhc2ljVHJhbnNpdGlvbiBjbGFzcyBjaGFuZ2VzIHNsaWRlcyB3aXRob3V0IGFueSBhbmltYXRpb24uDQogICAgICogRG8gbm90IHJlbW92ZSB0aGlzIGNsYXNzLCBiZWNhb3VzZSBjYXJvdXNlbHMgd2lsbCB1c2UgaXQgYnkgZGVmYXVsdCwNCiAgICAgKiBpZiByZXF1ZXN0ZWQgdHJhbnNpdGlvbiBjYW5ub3QgYmUgZm91bmQuDQogICAgICogQGNvbnN0cnVjdG9yDQogICAgICovDQogICAgZnVuY3Rpb24gQmFzaWNUcmFuc2l0aW9uKCkge30NCiAgICBCYXNpY1RyYW5zaXRpb24ucHJvdG90eXBlID0gbmV3IFRyYW5zaXRpb24oKTsNCiAgICBCYXNpY1RyYW5zaXRpb24uY29uc3RydWN0b3IgPSBCYXNpY1RyYW5zaXRpb247DQogICAgLyoqDQogICAgICogQG1lbWJlciBCYXNpY1RyYW5zaXRpb24NCiAgICAgKi8NCiAgICBCYXNpY1RyYW5zaXRpb24ucHJvdG90eXBlLnBlcmZvcm0gPSBmdW5jdGlvbihzZXR0aW5ncykgew0KICAgICAgICBzZXR0aW5ncy4kY3VycmVudFNsaWRlLmhpZGUoKTsNCiAgICAgICAgc2V0dGluZ3MuJG5leHRTbGlkZS5zaG93KCk7DQoNCiAgICAgICAgc2V0dGluZ3MuY2FsbGJhY2soKTsNCiAgICB9Ow0KICAgIC8qKg0KICAgICAqIEVuZCBvZiBCYXNpY1RyYW5zaXRpb24gY2xhc3MNCiAgICAgKi8NCiAgICBwdWIuQmFzaWNUcmFuc2l0aW9uID0gQmFzaWNUcmFuc2l0aW9uOw0KDQogICAgLyoqDQogICAgICogRmFkZUluVHJhbnNpdGlvbiBjbGFzcyBjaGFuZ2VzIHNsaWRlcyBieSBmYWRpbmcgaW4gbmV3IHNsaWRlLg0KICAgICAqIFRoaXMgY2xhc3MgY2FuIGJlIHJlbW92ZWQgaWYgZWZmZWN0IGlzIG5vdCB1c2VkLg0KICAgICAqIEBjb25zdHJ1Y3Rvcg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIEZhZGVJblRyYW5zaXRpb24oKSB7fQ0KICAgIEZhZGVJblRyYW5zaXRpb24ucHJvdG90eXBlID0gbmV3IFRyYW5zaXRpb24oKTsNCiAgICBGYWRlSW5UcmFuc2l0aW9uLmNvbnN0cnVjdG9yID0gRmFkZUluVHJhbnNpdGlvbjsNCiAgICAvKioNCiAgICAgKiBAbWVtYmVyIEZhZGVJblRyYW5zaXRpb24NCiAgICAgKi8NCiAgICBGYWRlSW5UcmFuc2l0aW9uLnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24oKSB7DQogICAgICAgIC8qc2V0dGluZ3MuJHNsaWRlcy5jc3Moew0KICAgICAgICAgJ3Bvc2l0aW9uJzogJ2Fic29sdXRlJywNCiAgICAgICAgICd0b3AnOiAnMHB4JywNCiAgICAgICAgICdsZWZ0JzogJzBweCcNCiAgICAgICAgIH0pOyovDQogICAgfTsNCiAgICAvKioNCiAgICAgKiBAbWVtYmVyIEZhZGVJblRyYW5zaXRpb24NCiAgICAgKi8NCiAgICBGYWRlSW5UcmFuc2l0aW9uLnByb3RvdHlwZS5wZXJmb3JtID0gZnVuY3Rpb24oc2V0dGluZ3MpIHsNCiAgICAgICAgdmFyIHpJbmRleEF0dHJpYiA9ICd6LWluZGV4JywNCiAgICAgICAgICAgICRwYXJlbnQgPSBzZXR0aW5ncy4kc2xpZGVzLnBhcmVudCgpLA0KICAgICAgICAgICAgJG5leHRTbGlkZSA9IHNldHRpbmdzLiRuZXh0U2xpZGU7DQoNCiAgICAgICAgJHBhcmVudC5jc3MoekluZGV4QXR0cmliLCAwKTsNCiAgICAgICAgJG5leHRTbGlkZS5jc3MoekluZGV4QXR0cmliLCAxKTsNCiAgICAgICAgc2V0dGluZ3MuJHNsaWRlcy5jc3Moew0KICAgICAgICAgICAgJ3Bvc2l0aW9uJzogJ3JlbGF0aXZlJw0KICAgICAgICB9KTsNCg0KICAgICAgICBzZXR0aW5ncy4kbmV4dFNsaWRlLmNzcyh7DQogICAgICAgICAgICAncG9zaXRpb24nOiAnYWJzb2x1dGUnLA0KICAgICAgICAgICAgJ3RvcCc6ICc1MCUnLA0KICAgICAgICAgICAgJ2xlZnQnOiAnNTAlJywNCiAgICAgICAgICAgICd0cmFuc2Zvcm0nOiAndHJhbnNsYXRlKC01MCUsLTUwJSknDQogICAgICAgIH0pOw0KDQoNCiAgICAgICAgJG5leHRTbGlkZS5mYWRlSW4oZnVuY3Rpb24oKSB7DQogICAgICAgICAgICBzZXR0aW5ncy4kY3VycmVudFNsaWRlLmhpZGUoKTsNCg0KICAgICAgICAgICAgc2V0dGluZ3MuJG5leHRTbGlkZS5jc3Moew0KICAgICAgICAgICAgICAgICdwb3NpdGlvbic6ICdyZWxhdGl2ZScsDQogICAgICAgICAgICAgICAgJ2xlZnQnOiAnMCcsDQogICAgICAgICAgICAgICAgJ3RyYW5zZm9ybSc6ICdub25lJw0KICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgICRuZXh0U2xpZGUuY3NzKHpJbmRleEF0dHJpYiwgJycpOw0KICAgICAgICAgICAgJHBhcmVudC5jc3MoekluZGV4QXR0cmliLCAnJyk7DQoNCiAgICAgICAgICAgIHNldHRpbmdzLmNhbGxiYWNrKCk7DQogICAgICAgIH0pOw0KICAgIH07DQogICAgLyoqDQogICAgICogRW5kIG9mIEZhZGVJblRyYW5zaXRpb24gY2xhc3MNCiAgICAgKi8NCiAgICBwdWIuRmFkZUluVHJhbnNpdGlvbiA9IEZhZGVJblRyYW5zaXRpb247DQoNCiAgICAvKioNCiAgICAgKiBTbGlkZUhvcml6b250YWxseVRyYW5zaXRpb24gY2xhc3MgY2hhbmdlcyBzbGlkZXMgYnkgc2xpZGluZyB0aGVtIGhvcml6b250YWxseS4NCiAgICAgKiBUaGlzIGNsYXNzIGNhbiBiZSByZW1vdmVkIGlmIGVmZmVjdCBpcyBub3QgdXNlZC4NCiAgICAgKiBJZiBvZmZzZXQgKGRpZmZlcmVuY2UgYmV0d2VlbiBpbmRleCBvZiBjdXJyZW50bHkgZGlzcGxheWVkIHNsaWRlIGFuZCBpbmRleCBvZiBzbGlkZSB0aGF0IHdpbGwgYmUgc2hvd24pDQogICAgICogaXMgZ3JlYXRlciB0aGFuIDAsIHNsaWRlcyBhcmUgc2xpZGluZyB0byB0aGUgbGVmdC4gT3RoZXJ3aXNlIChvZmZzZXQgaXMgbG93ZXIgdGhhbiAwKSwgc2xpZGVzIGFyZSBzbGlkaW5nDQogICAgICogdG8gdGhlIGxlZnQuDQogICAgICogV2hlbiBzbGlkZSBjaGFuZ2UgaXMgcmFpc2VkIGF1dG9tYXRpY2FsbHksIHNsaWRlcyBhcmUgYWx3YXlzIHNsaWRpbmcgdG8gcmlnaHQgKG9mZnNldCA9PSAxKS4NCiAgICAgKiBJZiB1c2VyIHJhaXNlcyBzbGlkZXMgY2hhbmdlLCBzbGlkZXMgYXJlIHNsaWRpbmc6DQogICAgICogLSB0byBsZWZ0LCBpZiBvZmZzZXQgaXMgZ3JlYXRlciB0aGFuIDAgKHNsaWRlIHdpdGggaGlnaGVyIGluZGV4IHdpbGwgYmUgc2hvd24gb3IgdXNlciBjbGlja3Mgb24gJ25leHQnIG5hdmlnYXRpb24gaXRlbSksDQogICAgICogLSB0byByaWdodCwgaWYgb2Zmc2V0IGlzIGxvd2VyIHRoYW4gMCAoc2xpZGUgd2l0aCBsb3dlciBpbmRleCB3aWxsIGJlIHNob3duIG9yIHVzZXIgY2xpY2tzIG9uICdwcmV2JyBuYXZpZ2F0aW9uIGl0ZW0pLg0KICAgICAqIEBjb25zdHJ1Y3Rvcg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIFNsaWRlSG9yaXpvbnRhbGx5VHJhbnNpdGlvbigpIHt9DQogICAgU2xpZGVIb3Jpem9udGFsbHlUcmFuc2l0aW9uLnByb3RvdHlwZSA9IG5ldyBUcmFuc2l0aW9uKCk7DQogICAgU2xpZGVIb3Jpem9udGFsbHlUcmFuc2l0aW9uLmNvbnN0cnVjdG9yID0gU2xpZGVIb3Jpem9udGFsbHlUcmFuc2l0aW9uOw0KICAgIC8qKg0KICAgICAqIEBtZW1iZXIgU2xpZGVIb3Jpem9udGFsbHlUcmFuc2l0aW9uDQogICAgICovDQogICAgU2xpZGVIb3Jpem9udGFsbHlUcmFuc2l0aW9uLnByb3RvdHlwZS5vbkFuaW1hdGlvbkNvbXBsZXRlID0gZnVuY3Rpb24oc2V0dGluZ3MsICRwYXJlbnQpIHsNCiAgICAgICAgc2V0dGluZ3MuJGN1cnJlbnRTbGlkZS5oaWRlKCk7DQogICAgICAgIHNldHRpbmdzLiRuZXh0U2xpZGUuY3NzKHsNCiAgICAgICAgICAgICdwb3NpdGlvbic6ICcnLA0KICAgICAgICAgICAgJ3RvcCc6ICcnLA0KICAgICAgICAgICAgJ2xlZnQnOiAnJw0KICAgICAgICB9KTsNCg0KICAgICAgICAkcGFyZW50LmNzcygnbWFyZ2luLWxlZnQnLCAnJyk7DQoNCiAgICAgICAgc2V0dGluZ3MuY2FsbGJhY2soKTsNCiAgICB9Ow0KICAgIC8qKg0KICAgICAqIEBtZW1iZXIgU2xpZGVIb3Jpem9udGFsbHlUcmFuc2l0aW9uDQogICAgICovDQogICAgU2xpZGVIb3Jpem9udGFsbHlUcmFuc2l0aW9uLnByb3RvdHlwZS5wZXJmb3JtID0gZnVuY3Rpb24oc2V0dGluZ3MpIHsNCiAgICAgICAgdmFyIGZhY3RvciA9IHRoaXMuZmFjdG9yKHNldHRpbmdzKSwNCiAgICAgICAgICAgIG9uQW5pbWF0aW9uQ29tcGxldGUgPSB0aGlzLm9uQW5pbWF0aW9uQ29tcGxldGUsDQogICAgICAgICAgICB3aWR0aCA9IHNldHRpbmdzLiRjdXJyZW50U2xpZGUud2lkdGgoKSwNCiAgICAgICAgICAgICRwYXJlbnQgPSBzZXR0aW5ncy4kc2xpZGVzLnBhcmVudCgpOw0KDQogICAgICAgIHNldHRpbmdzLiRuZXh0U2xpZGUuY3NzKHsNCiAgICAgICAgICAgICdwb3NpdGlvbic6ICdhYnNvbHV0ZScsDQogICAgICAgICAgICAndG9wJzogJzBweCcsDQogICAgICAgICAgICAnbGVmdCc6IGZhY3RvciAqIHdpZHRoDQogICAgICAgIH0pOw0KICAgICAgICBzZXR0aW5ncy4kbmV4dFNsaWRlLnNob3coKTsNCg0KICAgICAgICAkcGFyZW50LmFuaW1hdGUoew0KICAgICAgICAgICAgJ21hcmdpbi1sZWZ0JzogLWZhY3RvciAqIHdpZHRoDQogICAgICAgIH0sIGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgb25BbmltYXRpb25Db21wbGV0ZShzZXR0aW5ncywgJHBhcmVudCk7DQogICAgICAgIH0pOw0KICAgIH07DQogICAgLyoqDQogICAgICogRW5kIG9mIFNsaWRlSG9yaXpvbnRhbGx5VHJhbnNpdGlvbiBjbGFzcw0KICAgICAqLw0KICAgIHB1Yi5TbGlkZUhvcml6b250YWxseVRyYW5zaXRpb24gPSBTbGlkZUhvcml6b250YWxseVRyYW5zaXRpb247DQoNCiAgICAvKioNCiAgICAgKiBTbGlkZVZlcnRpY2FsbHlUcmFuc2l0aW9uIGNsYXNzIGNoYW5nZXMgc2xpZGVzIGJ5IHNsaWRpbmcgdGhlbSB2ZXJ0aWNhbGx5Lg0KICAgICAqIFRoaXMgY2xhc3MgY2FuIGJlIHJlbW92ZWQgaWYgdGhpcyBlZmZlY3QgaXMgbm90IHVzZWQuDQogICAgICogSWYgb2Zmc2V0IChkaWZmZXJlbmNlIGJldHdlZW4gaW5kZXggb2YgY3VycmVudGx5IGRpc3BsYXllZCBzbGlkZSBhbmQgaW5kZXggb2Ygc2xpZGUgdGhhdCB3aWxsIGJlIHNob3duKQ0KICAgICAqIGlzIGdyZWF0ZXIgdGhhbiAwLCBzbGlkZXMgYXJlIHNsaWRpbmcgZnJvbSB1cCB0byBkb3duLiBPdGhlcndpc2UgKG9mZnNldCBpcyBsb3dlciB0aGFuIDApLCBzbGlkZXMgYXJlIHNsaWRpbmcNCiAgICAgKiBmcm9tIGRvd24gdG8gdXAuDQogICAgICogV2hlbiBzbGlkZSBjaGFuZ2UgaXMgcmFpc2VkIGF1dG9tYXRpY2FsbHksIHNsaWRlcyBhcmUgYWx3YXlzIHNsaWRpbmcgZnJvbSB1cCB0byBkb3duIChvZmZzZXQgPT0gMSkuDQogICAgICogSWYgdXNlciByYWlzZXMgc2xpZGVzIGNoYW5nZSwgc2xpZGVzIGFyZSBzbGlkaW5nOg0KICAgICAqIC0gZnJvbSB1cCB0byBkb3duLCBpZiBvZmZzZXQgaXMgZ3JlYXRlciB0aGFuIDAgKHNsaWRlIHdpdGggaGlnaGVyIGluZGV4IHdpbGwgYmUgc2hvd24gb3IgdXNlciBjbGlja3Mgb24gJ25leHQnIG5hdmlnYXRpb24gaXRlbSksDQogICAgICogLSBmcm9tIGRvd24gdG8gdXAsIGlmIG9mZnNldCBpcyBsb3dlciB0aGFuIDAgKHNsaWRlIHdpdGggbG93ZXIgaW5kZXggd2lsbCBiZSBzaG93biBvciB1c2VyIGNsaWNrcyBvbiAncHJldicgbmF2aWdhdGlvbiBpdGVtKS4NCiAgICAgKiBAY29uc3RydWN0b3INCiAgICAgKi8NCiAgICBmdW5jdGlvbiBTbGlkZVZlcnRpY2FsbHlUcmFuc2l0aW9uKCkge30NCiAgICBTbGlkZVZlcnRpY2FsbHlUcmFuc2l0aW9uLnByb3RvdHlwZSA9IG5ldyBUcmFuc2l0aW9uKCk7DQogICAgU2xpZGVWZXJ0aWNhbGx5VHJhbnNpdGlvbi5jb25zdHJ1Y3RvciA9IFNsaWRlVmVydGljYWxseVRyYW5zaXRpb247DQogICAgLyoqDQogICAgICogQG1lbWJlciBTbGlkZVZlcnRpY2FsbHlUcmFuc2l0aW9uDQogICAgICovDQogICAgU2xpZGVWZXJ0aWNhbGx5VHJhbnNpdGlvbi5wcm90b3R5cGUub25BbmltYXRpb25Db21wbGV0ZSA9IGZ1bmN0aW9uKHNldHRpbmdzLCAkcGFyZW50KSB7DQogICAgICAgIHNldHRpbmdzLiRjdXJyZW50U2xpZGUuaGlkZSgpOw0KICAgICAgICBzZXR0aW5ncy4kbmV4dFNsaWRlLmNzcyh7DQogICAgICAgICAgICAncG9zaXRpb24nOiAnJywNCiAgICAgICAgICAgICd0b3AnOiAnJywNCiAgICAgICAgICAgICdsZWZ0JzogJycNCiAgICAgICAgfSk7DQoNCiAgICAgICAgJHBhcmVudC5jc3MoJ21hcmdpbi10b3AnLCAnJyk7DQoNCiAgICAgICAgc2V0dGluZ3MuY2FsbGJhY2soKTsNCiAgICB9Ow0KICAgIC8qKg0KICAgICAqIEBtZW1iZXIgU2xpZGVWZXJ0aWNhbGx5VHJhbnNpdGlvbg0KICAgICAqLw0KICAgIFNsaWRlVmVydGljYWxseVRyYW5zaXRpb24ucHJvdG90eXBlLnBlcmZvcm0gPSBmdW5jdGlvbihzZXR0aW5ncykgew0KICAgICAgICB2YXIgZmFjdG9yID0gdGhpcy5mYWN0b3Ioc2V0dGluZ3MpLA0KICAgICAgICAgICAgb25BbmltYXRpb25Db21wbGV0ZSA9IHRoaXMub25BbmltYXRpb25Db21wbGV0ZSwNCiAgICAgICAgICAgIGhlaWdodCA9IHNldHRpbmdzLiRjdXJyZW50U2xpZGUuaGVpZ2h0KCksDQogICAgICAgICAgICAkcGFyZW50ID0gc2V0dGluZ3MuJHNsaWRlcy5wYXJlbnQoKTsNCg0KICAgICAgICBzZXR0aW5ncy4kbmV4dFNsaWRlLmNzcyh7DQogICAgICAgICAgICAncG9zaXRpb24nOiAnYWJzb2x1dGUnLA0KICAgICAgICAgICAgJ3RvcCc6IC1mYWN0b3IgKiBoZWlnaHQsDQogICAgICAgICAgICAnbGVmdCc6ICcwcHgnDQogICAgICAgIH0pOw0KICAgICAgICBzZXR0aW5ncy4kbmV4dFNsaWRlLnNob3coKTsNCg0KICAgICAgICAkcGFyZW50LmFuaW1hdGUoew0KICAgICAgICAgICAgJ21hcmdpbi10b3AnOiBmYWN0b3IgKiBoZWlnaHQNCiAgICAgICAgfSwgZnVuY3Rpb24oKSB7DQogICAgICAgICAgICBvbkFuaW1hdGlvbkNvbXBsZXRlKHNldHRpbmdzLCAkcGFyZW50KTsNCiAgICAgICAgfSk7DQogICAgfTsNCiAgICAvKioNCiAgICAgKiBTbGlkZVZlcnRpY2FsbHlUcmFuc2l0aW9uIGNsYXNzDQogICAgICovDQogICAgcHViLlNsaWRlVmVydGljYWxseVRyYW5zaXRpb24gPSBTbGlkZVZlcnRpY2FsbHlUcmFuc2l0aW9uOw0KDQogICAgcmV0dXJuIHB1YjsNCn0oalF1ZXJ5KSk7DQovKioNCiAqIGVuZCBvZiBYQS5jb21wb25lbnQuY2Fyb3VzZWxzLlRyYW5zaXRpb25zIG1vZHVsZS4NCiAqLw0KDQovKioNCiAqIFhBQ29udGV4dA0KICoNCiAqIFhBLmNvbXBvbmVudC5jYXJvdXNlbHMuSW5kaWNhdG9yVmlld3MgbW9kdWxlLg0KICoNCiAqIEV4cG9zZXMgVmlldyBjbGFzcywgd2hpY2ggaXMgYSBiYXNlIGNsYXNzIG9mIGFsbCAndGltZSBpbmRpY2F0b3InIHZpZXdzIHVzZWQgYnkgY2Fyb3VzZWxzIChAc2VlIFhBLmNvbXBvbmVudC5jYXJvdXNlbHMsIEBzZWUgVmlldykuDQogKiBBbHNvIGV4cG9zZXMgaW1wbGVtZW50YXRpb24gb2YgdGhlc2UgJ3RpbWUgaW5kaWNhdG9yJyB2aWV3czoNCiAqIC0gUHJvZ3Jlc3NCYXJWaWV3IC0gc2hvd3MgdGhlIHByb2dyZXNzIG9mIHRpbWUsIHRoYXQgbG9va3MgbGlrZSBhIHByb2dyZXNzIGJhciwNCiAqIC0gUm90YXRvclZpZXcgLSBzaG93cyB0aGUgcHJvZ3Jlc3Mgb2YgdGltZSB3aXRoIHRoZSBmaWxsaW5nIHVwIHJpbmcuDQogKiBDYXJvdXNlbCB0YWtlcyB0aGUgY2xhc3MgY29uc3RydWN0b3IgYnkgbmFtZSBmcm9tIHRoaXMgbW9kdWxlIChpdCBpcyBnaXZlbiBpbiBvcHRpb25zIG9iamVjdCBvZiBjYXJvdXNlbDsgQHNlZSBYQS5jb21wb25lbnQuY2Fyb3VzZWxzKS4NCiAqIElmIHRoZXJlIGlzIGEgbmVlZCB0byBpbXBsZW1lbnQgdGhlIG5ldyAndGltZSBpbmRpY2F0b3InIHZpZXcsIGNyZWF0ZSBhIG5ldyBjbGFzcywNCiAqIGJ5IGluaGVyaXRpbmcgZnJvbSBWaWV3IGNsYXNzIGFuZCBhZGQgaXQgdG8gdGhpcyBtb2R1bGUuIER1cmluZyBpbXBsZW1lbnRhdGlvbiBvZiBhIG5ldyAndGltZSBpbmRpY2F0b3InDQogKiB2aWV3IHRoZSBYQS5jb21wb25lbnQuY2Fyb3VzZWxzLkluZGljYXRvcnNWaWV3LlRvb2xzIG5hbWVzcGFjZSBtYXkgYmUgdXNlZnVsbC4gSXQgY29udGFpbnM6DQogKiAtIGlzQ3NzU3VwcG9ydGVkKHByb3BzKSBmdW5jdGlvbiwgd2hpY2ggY2hlY2tzIGlmIGFueSBvZiBDU1MgcHJvcGVydGllcyBpcyBzdXBwb3J0ZWQgKHByb3BzIC0gYXJyYXkgb2YgcHJvcGVydGllcyksDQogKiAtIGlzVHJhbnNmb3JtU3VwcG9ydGVkKCkgZnVuY3Rpb24sIHdoaWNoIGNoZWNrcyBpZiBDU1MgMyAndHJhbnNmb3JtJyBpcyBzdXBwb3J0ZWQuDQogKg0KICogRXhhbXBsZSB2aWV3IGltcGxlbWVudGF0aW9uIChvcGFjaXR5IGluY3JlYXNlcyB3aXRoIGEgcHJvZ3Jlc3Mgb2YgdGhlIHRpbWUpOg0KICogKGZ1bmN0aW9uKCkgew0KICogICAgIHZhciBWaWV3ID0gWEEuY29tcG9uZW50LmNhcm91c2Vscy5JbmRpY2F0b3JWaWV3cy5WaWV3Ow0KICoNCiAqICAgICBmdW5jdGlvbiBTYW1wbGVWaWV3IChzZWxlY3Rvciwgb3B0aW9ucykgew0KICogICAgICAgICAvL2Jhc2UgY29uc3RydWN0b3IgaGF2ZSB0byBiZSBjYWxsZWQNCiAqICAgICAgICAgVmlldy5jYWxsKHRoaXMsIHNlbGVjdG9yKTsNCiAqICAgICB9DQogKg0KICogICAgIFNhbXBsZVZpZXcucHJvdG90eXBlID0gbmV3IFZpZXcoKTsNCiAqICAgICBTYW1wbGVWaWV3LmNvbnN0cnVjdG9yID0gU2FtcGxlVmlldzsNCiAqDQogKiAgICAgU2FtcGxlVmlldy5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uICh0aW1lb3V0KSB7DQogKiAgICAgICAgIC8vYmFzZSBtZXRob2QgaGF2ZSB0byBiZSBjYWxsZWQNCiAqICAgICAgICAgVmlldy5wcm90b3R5cGUuaW5pdC5jYWxsKHRoaXMsIHRpbWVvdXQpOw0KICoNCiAqICAgICAgICAgLy9pbml0aWFsaXphdGlvbiBjb2RlIC0gbm90IG5lZWRlZCBpbiB0aGlzIGV4YW1wbGUNCiAqICAgICB9Ow0KICoNCiAqICAgICBTYW1wbGVWaWV3LnByb3RvdHlwZS5yZXNldCA9IGZ1bmN0aW9uICgpIHsNCiAqICAgICAgICAgLy9iYXNlIG1ldGhvZCBoYXZlIHRvIGJlIGNhbGxlZA0KICogICAgICAgICBWaWV3LnByb3RvdHlwZS5yZXNldC5jYWxsKHRoaXMpOw0KICoNCiAqICAgICAgICAgLy9yZXNldGluZyAndGltZSBpbmRpY2F0b3InIHZpZXcNCiAqICAgICAgICAgdGhpcy4kaW5kaWNhdG9yLnN0b3AodHJ1ZSk7DQogKiAgICAgICAgIHRoaXMuJGluZGljYXRvci5jc3MoJ29wYWNpdHknLCAwKTsNCiAqICAgICB9Ow0KICoNCiAqICAgICBTYW1wbGVWaWV3LnByb3RvdHlwZS5wYXVzZSA9IGZ1bmN0aW9uICgpIHsNCiAqICAgICAgICAgLy9zdG9waW5nICd0aW1lIGluZGljYXRvcicgdmlldyBhbmltYXRpb24NCiAqICAgICAgICAgdGhpcy4kaW5kaWNhdG9yLnN0b3AodHJ1ZSk7DQogKiAgICAgfTsNCiAqDQogKiAgICAgU2FtcGxlVmlldy5wcm90b3R5cGUucGxheSA9IGZ1bmN0aW9uICgpIHsNCiAqICAgICAgICAgLy9zdGFydGluZy9yZXN1bWluZyAndGltZSBpbmRpY2F0b3InIHZpZXcgYW5pbWF0aW9uDQogKiAgICAgICAgIHRoaXMuJGluZGljYXRvci5hbmltYXRlKHsNCiAqICAgICAgICAgICAgICdvcGFjaXR5JzogMQ0KICogICAgICAgICB9LCB0aGlzLnRpbWVvdXQgLSB0aGlzLnRpbWVFbGFwc2VkLCAnbGluZWFyJyk7DQogKiAgICAgfTsNCiAqDQogKiAgICAgWEEuY29tcG9uZW50LmNhcm91c2Vscy5JbmRpY2F0b3JWaWV3cy5TYW1wbGVWaWV3ID0gU2FtcGxlVmlldzsNCiAqIH0oKSk7DQogKg0KICovDQpYQS5jb21wb25lbnQuY2Fyb3VzZWxzLkluZGljYXRvclZpZXdzID0gKGZ1bmN0aW9uKCQpIHsNCiAgICB2YXIgcHViID0ge30sDQogICAgICAgIHN1cHBvcnRFbGVtZW50U3R5bGUgPSBudWxsOw0KDQogICAgLyoqDQogICAgICogQ2hlY2tzIGlmIGFueSBvZiBDU1MgcHJvcGVydGllcyBpcyBzdXBwb3J0ZWQuDQogICAgICoNCiAgICAgKiBAcGFyYW0ge0FycmF5fSBwcm9wcyAgICAgYXJyYXkgb2YgcHJvcGVydGllcyB0byBiZSBjaGVja2VkDQogICAgICogQHJldHVybiB0cnVlIGlmIGFueSBvZiBDU1MgcHJvcGVydGllcyBpcyBzdXBwb3J0ZWQsIGZhbHNlIG90aGVyd2lzZQ0KICAgICAqIEB0eXBlIEJvb2xlYW4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBpc0Nzc1N1cHBvcnRlZChwcm9wcykgew0KICAgICAgICB2YXIgaSwNCiAgICAgICAgICAgIGlzU3VwcG9ydGVkID0gZmFsc2U7DQoNCiAgICAgICAgaWYgKHN1cHBvcnRFbGVtZW50U3R5bGUgPT09IG51bGwpIHsNCiAgICAgICAgICAgIHN1cHBvcnRFbGVtZW50U3R5bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzdXBwb3J0RWxlbWVudCcpLnN0eWxlOw0KICAgICAgICB9DQoNCiAgICAgICAgZm9yIChpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICBpZiAoc3VwcG9ydEVsZW1lbnRTdHlsZVtwcm9wc1tpXV0gIT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgICAgIGlzU3VwcG9ydGVkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiBpc1N1cHBvcnRlZDsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDaGVja3MgaWYgQ1NTIDMgJ3RyYW5zZm9ybScgaXMgc3VwcG9ydGVkLg0KICAgICAqDQogICAgICogQHJldHVybiB0cnVlIGlmIENTUyAzICd0cmFuc2Zvcm0nIGlzIHN1cHBvcnRlZCwgZmFsc2Ugb3RoZXJ3aXNlDQogICAgICogQHR5cGUgQm9vbGVhbg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGlzVHJhbnNmb3JtU3VwcG9ydGVkKCkgew0KICAgICAgICByZXR1cm4gaXNDc3NTdXBwb3J0ZWQoWyd0cmFuc2Zvcm1Qcm9wZXJ0eScsICdXZWJraXRUcmFuc2Zvcm0nLCAnTW96VHJhbnNmb3JtJywgJ09UcmFuc2Zvcm0nLCAnbXNUcmFuc2Zvcm0nXSk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogWEEuY29tcG9uZW50LmNhcm91c2Vscy5JbmRpY2F0b3JWaWV3cy5Ub29scyBuYW1lc3BhY2UNCiAgICAgKg0KICAgICBUaGlzIG5hbWVzcGFjZSBjYW4gYmUgcmVtb3ZlZCBpZiBSb3RhdG9yVmlldyBjbGFzcyBpcyBub3QgdXNlZCAoQHNlZSBSb3RhdG9yVmlldykNCiAgICAgKi8NCiAgICBwdWIuVG9vbHMgPSB7fTsNCiAgICBwdWIuVG9vbHMuaXNDc3NTdXBwb3J0ZWQgPSBpc0Nzc1N1cHBvcnRlZDsNCiAgICBwdWIuVG9vbHMuaXNUcmFuc2Zvcm1TdXBwb3J0ZWQgPSBpc1RyYW5zZm9ybVN1cHBvcnRlZDsNCiAgICAvKioNCiAgICAgKiBFbmQgb2YgbmFtZXNwYWNlDQogICAgICovDQoNCiAgICAvKioNCiAgICAgKiBWaWV3IGNsYXNzIGlzIGEgYmFzZSBjbGFzcyBvZiBhbGwgJ3RpbWUgaW5kaWNhdG9yJyB2aWV3cw0KICAgICAqIEBjb25zdHJ1Y3Rvcg0KICAgICAqIEBwYXJhbSB7U3RyaW5nfSBzZWxlY3RvciBhIHNlbGVjdG9yIHVzZWQgZm9yIHNlYXJjaGluZw0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zICAgVmlldyBvcHRpb25zIG9iamVjdA0KICAgICAqLw0KICAgIC8qIGVzbGludC1kaXNhYmxlICovDQogICAgZnVuY3Rpb24gVmlldyhzZWxlY3Rvciwgb3B0aW9ucykgew0KICAgICAgICAvKioNCiAgICAgICAgICogQSBqUXVlcnkgb2JqZWN0IGNvbnRhaW5pbmcgZWxlbWVudCwgd2hpY2ggd2lsbCBiZSBhbmltYXRlZCB0byBzaG93IHBvZ3Jlc3Mgb2YgdGhlIHRpbWUuDQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgVmlldw0KICAgICAgICAgKi8NCg0KICAgICAgICB0aGlzLiRpbmRpY2F0b3IgPSAkKHNlbGVjdG9yKTsNCiAgICB9DQogICAgLyogZXNsaW50LWVuYWJsZSAqLw0KICAgIC8qKg0KICAgICAqIEluaXRpYWxpemVzIHRoZSB2aWV3Lg0KICAgICAqDQogICAgICogQG1lbWJlciBWaWV3aW9uDQogICAgICogQHBhcmFtIHtOdW1iZXJ9IHRpbWVvdXQgICBhIHRpbWVvdXQgdG8gdGhlIGVuZCBvZiB3aG9sZSBpbmRpY2F0b3IgYW5pbWF0aW9uDQogICAgICovDQogICAgVmlldy5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uKHRpbWVvdXQpIHsNCiAgICAgICAgdGhpcy50aW1lRWxhcHNlZCA9IDA7DQogICAgICAgIHRoaXMudGltZW91dCA9IHRpbWVvdXQ7DQogICAgfTsNCiAgICAvKioNCiAgICAgKiBSZXNldHMgdGhlIHZpZXcNCiAgICAgKg0KICAgICAqIEBtZW1iZXIgVmlldw0KICAgICAqLw0KICAgIFZpZXcucHJvdG90eXBlLnJlc2V0ID0gZnVuY3Rpb24oKSB7DQogICAgICAgIHRoaXMudGltZUVsYXBzZWQgPSAwOw0KICAgIH07DQogICAgLyoqDQogICAgICogU3RhcnRzL1JlbmV3cyB0aGUgdmlldyBhbmltYXRpb24uDQogICAgICoNCiAgICAgKiBAbWVtYmVyIFZpZXcNCiAgICAgKi8NCiAgICBWaWV3LnByb3RvdHlwZS5wbGF5ID0gZnVuY3Rpb24oKSB7fTsNCiAgICAvKioNCiAgICAgKiBQYXVzZXMgdGhlIHZpZXcgYW5pbWF0aW9uLg0KICAgICAqDQogICAgICogQG1lbWJlciBWaWV3DQogICAgICovDQogICAgVmlldy5wcm90b3R5cGUucGF1c2UgPSBmdW5jdGlvbigpIHt9Ow0KICAgIC8qKg0KICAgICAqIFVwZGF0ZXMgdGhlIHRpbWUgdGhhdCBlbGFwc2VkIHNpbmNlIGFuaW1hdGlvbiBiZWdpbi4NCiAgICAgKg0KICAgICAqIEBtZW1iZXIgVmlldw0KICAgICAqLw0KICAgIFZpZXcucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uKHRpbWVFbGFwc2VkKSB7DQogICAgICAgIHRoaXMudGltZUVsYXBzZWQgPSB0aW1lRWxhcHNlZDsNCiAgICB9Ow0KICAgIC8qKg0KICAgICAqIGVuZCBvZiBWaWV3IGNsYXNzDQogICAgICovDQogICAgcHViLlZpZXcgPSBWaWV3Ow0KDQogICAgLyoqDQogICAgICogUHJvZ3Jlc3NCYXJWaWV3IGNsYXNzIHByb3ZpZGVzIGEgbG9naWMgZm9yIGFuaW1hdGUgYSAndGltZSBpbmRpY2F0b3InLA0KICAgICAqIHRoYXQgbG9va3MgbGlrZSBwcm9ncmVzcyBiYXIuDQogICAgICoNCiAgICAgKiBPcHRpb25zIG9iamVjdDoNCiAgICAgKiB7DQogICAgICogICAgICdvcGFjaXR5JzogTnVtYmVyIHZhbHVlIC8vYmV0d2VlbiAwIGFuZCAxOyBkZWZhdWx0IGlzIDAuOA0KICAgICAqIH0NCiAgICAgKg0KICAgICAqIFRoaXMgY2xhc3MgY2FuIGJlIHJlbW92ZWQgaWYgdGhpcyBraW5kIG9mIHZpZXcgaXMgbm90IHVzZWQuDQogICAgICoNCiAgICAgKiBAY29uc3RydWN0b3INCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gc2VsZWN0b3IgYSBzZWxlY3RvciB1c2VkIGZvciBzZWFyY2hpbmcNCiAgICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucyAgIFZpZXcgb3B0aW9ucyBvYmplY3QNCiAgICAgKi8NCiAgICBmdW5jdGlvbiBQcm9ncmVzc0JhclZpZXcoc2VsZWN0b3IsIG9wdGlvbnMpIHsNCiAgICAgICAgVmlldy5jYWxsKHRoaXMsIHNlbGVjdG9yKTsNCg0KICAgICAgICB2YXIgZGVmYXVsdHMgPSB7DQogICAgICAgICAgICAnb3BhY2l0eSc6IDAuOA0KICAgICAgICB9Ow0KDQogICAgICAgIHRoaXMuc2V0dGluZ3MgPSAkLmV4dGVuZCh0cnVlLCB7fSwgZGVmYXVsdHMsIG9wdGlvbnMpOw0KDQogICAgICAgIHRoaXMuJGNvbnRhaW5lciA9IHRoaXMuJGluZGljYXRvcjsNCiAgICAgICAgdGhpcy4kaW5kaWNhdG9yID0gdGhpcy4kaW5kaWNhdG9yLmZpbmQoJ2RpdicpOw0KICAgIH0NCiAgICBQcm9ncmVzc0JhclZpZXcucHJvdG90eXBlID0gbmV3IFZpZXcoKTsNCiAgICBQcm9ncmVzc0JhclZpZXcuY29uc3RydWN0b3IgPSBQcm9ncmVzc0JhclZpZXc7DQogICAgLyoqDQogICAgICogQG1lbWJlciBQcm9ncmVzc0JhclZpZXcNCiAgICAgKi8NCiAgICBQcm9ncmVzc0JhclZpZXcucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbih0aW1lb3V0KSB7DQogICAgICAgIFZpZXcucHJvdG90eXBlLmluaXQuY2FsbCh0aGlzLCB0aW1lb3V0KTsNCg0KICAgICAgICB2YXIgb3BhY2l0eSA9IHRoaXMuc2V0dGluZ3Mub3BhY2l0eTsNCiAgICAgICAgdGhpcy4kY29udGFpbmVyLmNzcygnb3BhY2l0eScsIG9wYWNpdHkpOw0KICAgICAgICB0aGlzLiRpbmRpY2F0b3IuY3NzKCdvcGFjaXR5Jywgb3BhY2l0eSk7DQogICAgfTsNCiAgICAvKioNCiAgICAgKiBAbWVtYmVyIFByb2dyZXNzQmFyVmlldw0KICAgICAqLw0KICAgIFByb2dyZXNzQmFyVmlldy5wcm90b3R5cGUucmVzZXQgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgVmlldy5wcm90b3R5cGUucmVzZXQuY2FsbCh0aGlzKTsNCg0KICAgICAgICB0aGlzLiRpbmRpY2F0b3Iuc3RvcCh0cnVlKTsNCiAgICAgICAgdGhpcy4kaW5kaWNhdG9yLmNzcygnd2lkdGgnLCAnMHB4Jyk7DQogICAgfTsNCiAgICAvKioNCiAgICAgKiBAbWVtYmVyIFByb2dyZXNzQmFyVmlldw0KICAgICAqLw0KICAgIFByb2dyZXNzQmFyVmlldy5wcm90b3R5cGUucGF1c2UgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgdGhpcy4kaW5kaWNhdG9yLnN0b3AodHJ1ZSk7DQogICAgfTsNCiAgICAvKioNCiAgICAgKiBAbWVtYmVyIFByb2dyZXNzQmFyVmlldw0KICAgICAqLw0KICAgIFByb2dyZXNzQmFyVmlldy5wcm90b3R5cGUucGxheSA9IGZ1bmN0aW9uKCkgew0KICAgICAgICB0aGlzLiRpbmRpY2F0b3IuYW5pbWF0ZSh7DQogICAgICAgICAgICAnd2lkdGgnOiAnMTAwJScNCiAgICAgICAgfSwgdGhpcy50aW1lb3V0IC0gdGhpcy50aW1lRWxhcHNlZCwgJ2xpbmVhcicpOw0KICAgIH07DQogICAgLyoqDQogICAgICogZW5kIG9mIFByb2dyZXNzQmFyVmlldyBjbGFzcw0KICAgICAqLw0KICAgIHB1Yi5Qcm9ncmVzc0JhclZpZXcgPSBQcm9ncmVzc0JhclZpZXc7DQoNCiAgICAvKioNCiAgICAgKiBSb3RhdG9yVmlldyBjbGFzcyBwcm92aWRlcyBhIGxvZ2ljIGZvciBhbmltYXRlIGEgJ3RpbWUgaW5kaWNhdG9yJywNCiAgICAgKiB0aGF0IHNob3dzIHRoZSBwcm9ncmVzcyBvZiB0aW1lIHdpdGggdGhlIGZpbGxpbmcgdXAgcmluZw0KICAgICAqDQogICAgICogT3B0aW9ucyBvYmplY3Q6DQogICAgICogew0KICAgICAqICAgICAnb3BhY2l0eSc6IE51bWJlciB2YWx1ZSAvL2JldHdlZW4gMCBhbmQgMTsgZGVmYXVsdCBpcyAwLjUNCiAgICAgKiB9DQogICAgICoNCiAgICAgKiBUaGlzIGNsYXNzIGNhbiBiZSByZW1vdmVkIGlmIHRoaXMga2luZCBvZiB2aWV3IGlzIG5vdCB1c2VkLg0KICAgICAqDQogICAgICogQGNvbnN0cnVjdG9yDQogICAgICogQHBhcmFtIHtTdHJpbmd9IHNlbGVjdG9yIGEgc2VsZWN0b3IgdXNlZCBmb3Igc2VhcmNoaW5nDQogICAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgICBWaWV3IG9wdGlvbnMgb2JqZWN0DQogICAgICovDQogICAgZnVuY3Rpb24gUm90YXRvclZpZXcoc2VsZWN0b3IsIG9wdGlvbnMpIHsNCiAgICAgICAgVmlldy5jYWxsKHRoaXMsIHNlbGVjdG9yKTsNCg0KICAgICAgICB2YXIgZGVmYXVsdHMgPSB7DQogICAgICAgICAgICAnb3BhY2l0eSc6IDAuNQ0KICAgICAgICB9Ow0KDQogICAgICAgIHRoaXMuc2V0dGluZ3MgPSAkLmV4dGVuZCh0cnVlLCB7fSwgZGVmYXVsdHMsIG9wdGlvbnMpOw0KICAgICAgICB0aGlzLiRtYXNrID0gdGhpcy4kaW5kaWNhdG9yLmZpbmQoJ3NwYW4ubWFzaycpLmZpcnN0KCk7DQogICAgICAgIHRoaXMuJHJvdGF0b3IgPSB0aGlzLiRpbmRpY2F0b3IuZmluZCgnc3Bhbi5yb3RhdG9yJykuZmlyc3QoKTsNCg0KICAgICAgICBmdW5jdGlvbiByb3RhdGVDc3MoZGVnKSB7DQogICAgICAgICAgICB2YXIgdmFsdWUgPSAncm90YXRlKCcgKyBkZWcgKyAnZGVnKSc7DQoNCiAgICAgICAgICAgIHJldHVybiB7DQogICAgICAgICAgICAgICAgJy13ZWJraXQtdHJhbnNmb3JtJzogdmFsdWUsDQogICAgICAgICAgICAgICAgJy1tb3otdHJhbnNmb3JtJzogdmFsdWUsDQogICAgICAgICAgICAgICAgJy1vLXRyYW5zZm9ybSc6IHZhbHVlLA0KICAgICAgICAgICAgICAgICctbXMtdHJhbnNmb3JtJzogdmFsdWUsDQogICAgICAgICAgICAgICAgJ3RyYW5zZm9ybSc6IHZhbHVlDQogICAgICAgICAgICB9Ow0KICAgICAgICB9DQoNCiAgICAgICAgZnVuY3Rpb24gYW5pbWF0ZVJvdGF0b3IoJHJvdGF0b3IsIG9wdGlvbnMpIHsNCiAgICAgICAgICAgIHZhciBkZWZhdWx0cyA9IHsNCiAgICAgICAgICAgICAgICAgICAgJ2ZvbnRTaXplJzogJzE4MHB4JywNCiAgICAgICAgICAgICAgICAgICAgJ2FuaW1hdGVPcHRpb25zJzogew0KICAgICAgICAgICAgICAgICAgICAgICAgJ3N0ZXAnOiBmdW5jdGlvbihub3cpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcm90YXRvci5jc3Mocm90YXRlQ3NzKG5vdykpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgICAgICdlYXNpbmcnOiAnbGluZWFyJw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICBzZXR0aW5ncyA9ICQuZXh0ZW5kKHRydWUsIHt9LCBkZWZhdWx0cywgb3B0aW9ucyk7DQoNCiAgICAgICAgICAgICRyb3RhdG9yLmFuaW1hdGUoew0KICAgICAgICAgICAgICAgICAgICAnZm9udC1zaXplJzogc2V0dGluZ3MuZm9udFNpemUNCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgIHNldHRpbmdzLmFuaW1hdGVPcHRpb25zKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGZ1bmN0aW9uIHBoYXNlVHdvQW5pbWF0aW9uKCRtYXNrLCAkcm90YXRvciwgZHVyYXRpb24pIHsNCiAgICAgICAgICAgICRyb3RhdG9yLmFkZENsYXNzKCdoYWxmJyk7DQogICAgICAgICAgICAkbWFzay5hZGRDbGFzcygnaGFsZicpOw0KDQogICAgICAgICAgICBhbmltYXRlUm90YXRvcigkcm90YXRvciwgew0KICAgICAgICAgICAgICAgICdmb250U2l6ZSc6ICczNjBweCcsDQogICAgICAgICAgICAgICAgJ2FuaW1hdGVPcHRpb25zJzogew0KICAgICAgICAgICAgICAgICAgICAnZHVyYXRpb24nOiBkdXJhdGlvbg0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQoNCiAgICAgICAgZnVuY3Rpb24gcGhhc2VPbmVBbmltYXRpb24oJG1hc2ssICRyb3RhdG9yLCBkdXJhdGlvbiwgcGhhc2VUd29EdXJhdGlvbikgew0KICAgICAgICAgICAgYW5pbWF0ZVJvdGF0b3IoJHJvdGF0b3IsIHsNCiAgICAgICAgICAgICAgICAnYW5pbWF0ZU9wdGlvbnMnOiB7DQogICAgICAgICAgICAgICAgICAgICdkdXJhdGlvbic6IGR1cmF0aW9uLA0KICAgICAgICAgICAgICAgICAgICAnY29tcGxldGUnOiBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHBoYXNlVHdvQW5pbWF0aW9uKCRtYXNrLCAkcm90YXRvciwgcGhhc2VUd29EdXJhdGlvbik7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KDQogICAgICAgIHRoaXMucmVzZXRDc3MgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgIHRoaXMuJHJvdGF0b3IucmVtb3ZlQ2xhc3MoJ2hhbGYnKTsNCiAgICAgICAgICAgIHRoaXMuJHJvdGF0b3IuY3NzKHJvdGF0ZUNzcygwKSk7DQogICAgICAgICAgICB0aGlzLiRyb3RhdG9yLmNzcygnZm9udC1zaXplJywgJzBweCcpOw0KDQogICAgICAgICAgICB0aGlzLiRtYXNrLnJlbW92ZUNsYXNzKCdoYWxmJyk7DQogICAgICAgIH07DQoNCiAgICAgICAgdGhpcy5wbGF5UGhhc2VPbmUgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgIHZhciBkdXJhdGlvbiA9IHRoaXMudGltZW91dCAvIDIgLSB0aGlzLnRpbWVFbGFwc2VkOw0KICAgICAgICAgICAgcGhhc2VPbmVBbmltYXRpb24odGhpcy4kbWFzaywgdGhpcy4kcm90YXRvciwgZHVyYXRpb24sIHRoaXMudGltZW91dCAvIDIpOw0KICAgICAgICB9Ow0KDQogICAgICAgIHRoaXMucGxheVBoYXNlVHdvID0gZnVuY3Rpb24oKSB7DQogICAgICAgICAgICB2YXIgZHVyYXRpb24gPSB0aGlzLnRpbWVvdXQgLSB0aGlzLnRpbWVFbGFwc2VkOw0KICAgICAgICAgICAgcGhhc2VUd29BbmltYXRpb24odGhpcy4kbWFzaywgdGhpcy4kcm90YXRvciwgZHVyYXRpb24pOw0KICAgICAgICB9Ow0KICAgIH0NCiAgICBSb3RhdG9yVmlldy5wcm90b3R5cGUgPSBuZXcgVmlldygpOw0KICAgIFJvdGF0b3JWaWV3LmNvbnN0cnVjdG9yID0gUm90YXRvclZpZXc7DQogICAgLyoqDQogICAgICogQG1lbWJlciBSb3RhdG9yVmlldw0KICAgICAqLw0KICAgIFJvdGF0b3JWaWV3LnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24odGltZW91dCkgew0KICAgICAgICBWaWV3LnByb3RvdHlwZS5pbml0LmNhbGwodGhpcywgdGltZW91dCk7DQoNCiAgICAgICAgaWYgKGlzVHJhbnNmb3JtU3VwcG9ydGVkKCkpIHsNCiAgICAgICAgICAgIHRoaXMuJGluZGljYXRvci5zaG93KCk7DQogICAgICAgICAgICB0aGlzLiRtYXNrLmNzcygnb3BhY2l0eScsIHRoaXMuc2V0dGluZ3Mub3BhY2l0eSk7DQogICAgICAgIH0NCiAgICB9Ow0KICAgIC8qKg0KICAgICAqIEBtZW1iZXIgUm90YXRvclZpZXcNCiAgICAgKi8NCiAgICBSb3RhdG9yVmlldy5wcm90b3R5cGUucmVzZXQgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgVmlldy5wcm90b3R5cGUucmVzZXQuY2FsbCh0aGlzKTsNCg0KICAgICAgICB0aGlzLiRyb3RhdG9yLnN0b3AodHJ1ZSk7DQogICAgICAgIHRoaXMucmVzZXRDc3MoKTsNCiAgICB9Ow0KICAgIC8qKg0KICAgICAqIEBtZW1iZXIgUm90YXRvclZpZXcNCiAgICAgKi8NCiAgICBSb3RhdG9yVmlldy5wcm90b3R5cGUucGF1c2UgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgdGhpcy4kcm90YXRvci5zdG9wKHRydWUpOw0KICAgIH07DQogICAgLyoqDQogICAgICogQG1lbWJlciBSb3RhdG9yVmlldw0KICAgICAqLw0KICAgIFJvdGF0b3JWaWV3LnByb3RvdHlwZS5wbGF5ID0gZnVuY3Rpb24oKSB7DQogICAgICAgIHZhciBwaGFzZSA9IHRoaXMucGxheVBoYXNlT25lOw0KICAgICAgICBpZiAodGhpcy50aW1lRWxhcHNlZCA+PSB0aGlzLnRpbWVvdXQgLyAyKSB7DQogICAgICAgICAgICBwaGFzZSA9IHRoaXMucGxheVBoYXNlVHdvOw0KICAgICAgICB9DQoNCiAgICAgICAgcGhhc2UuY2FsbCh0aGlzKTsNCiAgICB9Ow0KICAgIC8qKg0KICAgICAqIGVuZCBvZiBSb3RhdG9yVmlldyBjbGFzcw0KICAgICAqLw0KICAgIHB1Yi5Sb3RhdG9yVmlldyA9IFJvdGF0b3JWaWV3Ow0KDQogICAgcmV0dXJuIHB1YjsNCn0oalF1ZXJ5KSk7DQovKioNCiAqIGVuZCBvZiBYQS5jb21wb25lbnQuY2Fyb3VzZWxzLkluZGljYXRvclZpZXdzIG1vZHVsZS4NCiAqLw==
- ID: "6954b7c7-2487-423f-8600-436cb3b6dc0e"
  Hint: Size
  Value: 71161
- ID: "6f47a0a5-9c94-4b48-abeb-42d38def6054"
  Hint: Mime Type
  Value: "application/x-javascript"
- ID: "c06867fe-9a43-4c7d-b739-48780492d06f"
  Hint: Extension
  Value: js
Languages:
- Language: en
  Versions:
  - Version: 1
    Fields:
    - ID: "25bed78c-4957-4165-998a-ca1b52f67497"
      Hint: __Created
      Value: 20160811T135342Z
  - Version: 2
    Fields:
    - ID: "25bed78c-4957-4165-998a-ca1b52f67497"
      Hint: __Created
      Value: 20160811T135342Z
  - Version: 3
    Fields:
    - ID: "25bed78c-4957-4165-998a-ca1b52f67497"
      Hint: __Created
      Value: "20171212T111416:636486740564940746Z"
  - Version: 4
    Fields:
    - ID: "25bed78c-4957-4165-998a-ca1b52f67497"
      Hint: __Created
      Value: "20171212T111416:636486740564940746Z"
